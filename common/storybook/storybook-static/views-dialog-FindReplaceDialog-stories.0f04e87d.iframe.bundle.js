"use strict";(self.webpackChunk_univerjs_storybook=self.webpackChunk_univerjs_storybook||[]).push([[5104],{"../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.98.0_@swc+core@1.10.18_esbuild@0.25.0_/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[14].use[1]!../../node_modules/.pnpm/less-loader@12.2.0_less@4.2.2_webpack@5.98.0_@swc+core@1.10.18_esbuild@0.25.0_/node_modules/less-loader/dist/cjs.js??ruleSet[1].rules[14].use[2]!../../packages/find-replace/src/views/dialog/FindReplaceDialog.module.less":(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _node_modules_pnpm_css_loader_7_1_2_webpack_5_98_0_swc_core_1_10_18_esbuild_0_25_0_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.98.0_@swc+core@1.10.18_esbuild@0.25.0_/node_modules/css-loader/dist/runtime/sourceMaps.js"),_node_modules_pnpm_css_loader_7_1_2_webpack_5_98_0_swc_core_1_10_18_esbuild_0_25_0_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_pnpm_css_loader_7_1_2_webpack_5_98_0_swc_core_1_10_18_esbuild_0_25_0_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__),_node_modules_pnpm_css_loader_7_1_2_webpack_5_98_0_swc_core_1_10_18_esbuild_0_25_0_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.98.0_@swc+core@1.10.18_esbuild@0.25.0_/node_modules/css-loader/dist/runtime/api.js"),___CSS_LOADER_EXPORT___=__webpack_require__.n(_node_modules_pnpm_css_loader_7_1_2_webpack_5_98_0_swc_core_1_10_18_esbuild_0_25_0_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__)()(_node_modules_pnpm_css_loader_7_1_2_webpack_5_98_0_swc_core_1_10_18_esbuild_0_25_0_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default());___CSS_LOADER_EXPORT___.push([module.id,".univer-find-replace-dialog-container {\n  display: block;\n}\n.univer-find-replace-expand-container {\n  margin-top: 16px;\n  text-align: center;\n}\n.univer-find-replace-expand-container .univer-button-text {\n  color: rgb(var(--primary-color));\n}\n.univer-find-replace-buttons-group {\n  display: flex;\n  justify-content: space-between;\n  margin-top: 24px;\n}\n.univer-find-replace-buttons-group-right > button:not(:first-child) {\n  margin-left: 8px;\n}\n","",{version:3,sources:["webpack://./../../packages/find-replace/src/views/dialog/FindReplaceDialog.module.less"],names:[],mappings:"AACI;EACI,cAAA;AAAR;AAGI;EACI,gBAAA;EACA,kBAAA;AADR;AADI;EAKQ,gCAAA;AADZ;AAKI;EACI,aAAA;EACA,8BAAA;EACA,gBAAA;AAHR;AAOgB;EACI,gBAAA;AALpB",sourcesContent:[".find-replace {\n    &-dialog-container {\n        display: block;\n    }\n\n    &-expand-container {\n        margin-top: 16px;\n        text-align: center;\n\n        .button-text {\n            color: rgb(var(--primary-color));\n        }\n    }\n\n    &-buttons-group {\n        display: flex;\n        justify-content: space-between;\n        margin-top: 24px;\n\n        &-right {\n            > button {\n                &:not(:first-child) {\n                    margin-left: 8px;\n                }\n            }\n        }\n    }\n}\n"],sourceRoot:""}]),___CSS_LOADER_EXPORT___.locals={findReplaceDialogContainer:"univer-find-replace-dialog-container",findReplaceExpandContainer:"univer-find-replace-expand-container",buttonText:"univer-button-text",findReplaceButtonsGroup:"univer-find-replace-buttons-group",findReplaceButtonsGroupRight:"univer-find-replace-buttons-group-right"};const __WEBPACK_DEFAULT_EXPORT__=___CSS_LOADER_EXPORT___},"../../node_modules/.pnpm/rxjs@7.8.1/node_modules/rxjs/dist/esm5/internal/operators/takeUntil.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Q:()=>takeUntil});var _util_lift__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/rxjs@7.8.1/node_modules/rxjs/dist/esm5/internal/util/lift.js"),_OperatorSubscriber__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/rxjs@7.8.1/node_modules/rxjs/dist/esm5/internal/operators/OperatorSubscriber.js"),_observable_innerFrom__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/rxjs@7.8.1/node_modules/rxjs/dist/esm5/internal/observable/innerFrom.js"),_util_noop__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/.pnpm/rxjs@7.8.1/node_modules/rxjs/dist/esm5/internal/util/noop.js");function takeUntil(notifier){return(0,_util_lift__WEBPACK_IMPORTED_MODULE_0__.N)((function(source,subscriber){(0,_observable_innerFrom__WEBPACK_IMPORTED_MODULE_1__.Tg)(notifier).subscribe((0,_OperatorSubscriber__WEBPACK_IMPORTED_MODULE_2__._)(subscriber,(function(){return subscriber.complete()}),_util_noop__WEBPACK_IMPORTED_MODULE_3__.l)),!subscriber.closed&&source.subscribe(subscriber)}))}},"../../packages/find-replace/src/views/dialog/FindReplaceDialog.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{FindDialog:()=>FindReplaceDialog_stories_FindDialog,ReplaceDialog:()=>FindReplaceDialog_stories_ReplaceDialog,__namedExportsOrder:()=>__namedExportsOrder,default:()=>FindReplaceDialog_stories});var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@19.0.0/node_modules/react/jsx-runtime.js"),src=__webpack_require__("../../packages/core/src/index.ts"),ui_src=__webpack_require__("../../packages/ui/src/index.ts"),react=__webpack_require__("../../node_modules/.pnpm/react@19.0.0/node_modules/react/index.js"),icon=__webpack_require__("../../node_modules/.pnpm/@univerjs+icons@0.2.22_react-dom@19.0.0_react@19.0.0__react@19.0.0/node_modules/@univerjs/icons/esm/icon.js"),search_single_element={tag:"svg",attrs:{fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M7.71899 1.36938C4.37604 1.36938 1.66602 4.07941 1.66602 7.42236C1.66602 10.7653 4.37604 13.4753 7.71899 13.4753C9.16744 13.4753 10.4971 12.9666 11.5389 12.118L13.6598 14.4109C13.8848 14.6542 14.2644 14.669 14.5077 14.444C14.7509 14.219 14.7657 13.8393 14.5407 13.5961L12.3906 11.2716C13.2536 10.2254 13.772 8.88442 13.772 7.42236C13.772 4.07941 11.0619 1.36938 7.71899 1.36938ZM2.86602 7.42236C2.86602 4.74215 5.03878 2.56938 7.71899 2.56938C10.3992 2.56938 12.572 4.74215 12.572 7.42236C12.572 10.1026 10.3992 12.2753 7.71899 12.2753C5.03878 12.2753 2.86602 10.1026 2.86602 7.42236Z",fillRule:"evenodd",clipRule:"evenodd"}}]},SearchSingle=(0,react.forwardRef)((function(props,ref){return(0,react.createElement)(icon.z,Object.assign({},props,{id:"search-single",ref,icon:search_single_element}))}));SearchSingle.displayName="SearchSingle";const search_single=SearchSingle;var takeUntil=__webpack_require__("../../node_modules/.pnpm/rxjs@7.8.1/node_modules/rxjs/dist/esm5/internal/operators/takeUntil.js"),design_src=__webpack_require__("../../packages/design/src/index.ts"),engine_render_src=__webpack_require__("../../packages/engine-render/src/index.ts"),BehaviorSubject=__webpack_require__("../../node_modules/.pnpm/rxjs@7.8.1/node_modules/rxjs/dist/esm5/internal/BehaviorSubject.js"),throttleTime=__webpack_require__("../../node_modules/.pnpm/rxjs@7.8.1/node_modules/rxjs/dist/esm5/internal/operators/throttleTime.js"),combineLatest=__webpack_require__("../../node_modules/.pnpm/rxjs@7.8.1/node_modules/rxjs/dist/esm5/internal/observable/combineLatest.js"),debounceTime=__webpack_require__("../../node_modules/.pnpm/rxjs@7.8.1/node_modules/rxjs/dist/esm5/internal/operators/debounceTime.js"),Subject=__webpack_require__("../../node_modules/.pnpm/rxjs@7.8.1/node_modules/rxjs/dist/esm5/internal/Subject.js");function _ts_decorate(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r}function _ts_metadata(k,v){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(k,v)}function _ts_param(paramIndex,decorator){return function(target,key){decorator(target,key,paramIndex)}}const IFindReplaceService=(0,src.Qmd)("find-replace.service");class FindReplaceModel extends src.jGt{get searched(){return this._findModels.length>0}constructor(_state,_providers,_univerInstanceService,_commandService){super(),this._state=_state,this._providers=_providers,this._univerInstanceService=_univerInstanceService,this._commandService=_commandService,this.currentMatch$=new BehaviorSubject.t(null),this.replaceables$=new BehaviorSubject.t([]),this._findModels=[],this._matchingModel=null,this._matches=[],this._currentSearchingDisposables=null,this.disposeWithMe(this._state.stateUpdates$.pipe((0,throttleTime.c)(200,void 0,{leading:!0,trailing:!0})).subscribe((async stateUpdate=>{const state=this._state.state;(function shouldStateUpdateTriggerResearch(statusUpdate){return void 0!==statusUpdate.findString||void 0!==statusUpdate.inputtingFindString||void 0!==statusUpdate.findDirection||void 0!==statusUpdate.matchesTheWholeCell||void 0!==statusUpdate.caseSensitive||void 0!==statusUpdate.findScope||void 0!==statusUpdate.findBy})(stateUpdate)&&(""===state.findString||state.replaceRevealed?!0!==stateUpdate.replaceRevealed&&this._stopSearching():(await this._startSearching(),this._state.changeState({findCompleted:!0})))})))}dispose(){super.dispose(),this._stopSearching(),this.currentMatch$.complete(),this.replaceables$.complete(),this._state.changeState({caseSensitive:!1,findBy:"value",findCompleted:!1,findDirection:"row",findScope:"subunit",findString:"",inputtingFindString:"",matchesCount:0,matchesPosition:0,matchesTheWholeCell:!1,replaceRevealed:!1,replaceString:"",revealed:!0,revealed:!1})}async start(){if(!this._state.findString)return{results:[]};const complete=await this._startSearching();return this._state.changeState({findCompleted:!0}),complete}focusSelection(){this._matchingModel?.focusSelection()}async _startSearching(){if(!this._state.findString)return{results:[]};const providers=Array.from(this._providers),findModels=this._findModels=(await Promise.all(providers.map((provider=>provider.find({findString:this._state.findString,findDirection:this._state.findDirection,findScope:this._state.findScope,findBy:this._state.findBy,replaceRevealed:this._state.replaceRevealed,caseSensitive:this._state.caseSensitive,matchesTheWholeCell:this._state.matchesTheWholeCell}))))).flat();this._subscribeToModelsChanges(findModels);const newMatches=this._matches=findModels.map((c=>c.getMatches())).flat();return this.replaceables$.next(newMatches.filter((m=>m.replaceable))),newMatches.length?(this._moveToInitialMatch(findModels),this._state.changeState({matchesCount:newMatches.length}),{results:newMatches}):(this._state.changeState({matchesCount:0,matchesPosition:0}),{results:[]})}_stopSearching(){this._providers.forEach((provider=>provider.terminate())),this._findModels=[],this._matches=[],this._matchingModel=null,this._currentSearchingDisposables?.dispose(),this._currentSearchingDisposables=null,this.currentMatch$.next(null),this.replaceables$.next([]),this._state.changeState({findCompleted:!1,matchesCount:0,matchesPosition:0})}_subscribeToModelsChanges(models){const disposables=this._currentSearchingDisposables=new src.VdD,matchesUpdateSubscription=(0,combineLatest.z)(models.map((model=>model.matchesUpdate$))).pipe((0,debounceTime.B)(220)).subscribe((([...allMatches])=>{const newMatches=this._matches=allMatches.flat();newMatches.length?(this._moveToInitialMatch(this._findModels,!0),this._state.changeState({matchesCount:newMatches.length}),this.replaceables$.next(newMatches.filter((m=>m.replaceable)))):(this._state.changeState({matchesCount:0,matchesPosition:0}),this.replaceables$.next([]))}));models.forEach((model=>disposables.add((0,src.saO)(model.activelyChangingMatch$.subscribe((match=>{const index=this._matches.findIndex((m=>m===match));this._state.changeState({matchesPosition:index+1})})))))),disposables.add((0,src.saO)(matchesUpdateSubscription))}async replace(){return!!this._matchingModel&&this._matchingModel.replace(this._state.replaceString)}async replaceAll(){const result=await Promise.all(this._findModels.map((m=>m.replaceAll(this._state.replaceString)))).then((results=>results.reduce(((acc,cur)=>(acc.success+=cur.success,acc.failure+=cur.failure,acc)),{success:0,failure:0})));return 0===result.failure&&this._stopSearching(),result}getCurrentMatch(){return this._state.matchesPosition>0?this._matches[this._state.matchesPosition-1]:null}_markMatch(match){const index=this._matches.findIndex((value=>value===match));this.currentMatch$.next(match),this._state.changeState({matchesPosition:index+1})}moveToNextMatch(){if(!this._matchingModel)return;const loopInCurrentUnit=1===this._findModels.length,nextMatch=this._matchingModel.moveToNextMatch({loop:loopInCurrentUnit});if(nextMatch)return this._markMatch(nextMatch),nextMatch;{const currentModelIndex=this._findModels.findIndex((m=>m===this._matchingModel));return this._moveToNextUnitMatch(currentModelIndex)}}_moveToNextUnitMatch(startingIndex){const l=this._findModels.length;for(let i=(startingIndex+1)%l;i!==startingIndex;){const nextPositionModel=this._findModels[i],nextMatch=nextPositionModel.moveToNextMatch({ignoreSelection:!0});if(nextMatch)return this._matchingModel=nextPositionModel,this._markMatch(nextMatch),nextMatch;i=(i+1)%l}if(this._matchingModel){const nextMatch=this._matchingModel.moveToNextMatch({ignoreSelection:!0});return nextMatch&&this._markMatch(nextMatch),nextMatch}}moveToPreviousMatch(){if(!this._matchingModel)return;const loopInCurrentUnit=1===this._findModels.length,nextMatch=this._matchingModel.moveToPreviousMatch({loop:loopInCurrentUnit});if(nextMatch){const index=this._matches.findIndex((value=>value===nextMatch));return this.currentMatch$.next(nextMatch),this._state.changeState({matchesPosition:index+1}),nextMatch}{const l=this._findModels.length,currentModelIndex=this._findModels.findIndex((m=>m===this._matchingModel));for(let i=(currentModelIndex-1+l)%l;i!==currentModelIndex;){const nextPositionModel=this._findModels[i],nextMatch=nextPositionModel.moveToPreviousMatch({ignoreSelection:!0});if(nextMatch)return this._matchingModel=nextPositionModel,this._markMatch(nextMatch),nextMatch;i=(i-1)%l}const nextMatch=this._matchingModel.moveToPreviousMatch({ignoreSelection:!0});return nextMatch&&this._markMatch(nextMatch),nextMatch}}_moveToInitialMatch(findModels,noFocus=!1){const focusedUnitId=this._univerInstanceService.getFocusedUnit()?.getUnitId();if(!focusedUnitId)return-1;const i=findModels.findIndex((model=>model.unitId===focusedUnitId));if(-1!==i){this._matchingModel=findModels[i];const nextMatch=this._matchingModel.moveToNextMatch({stayIfOnMatch:!0,noFocus});if(nextMatch)return this._markMatch(nextMatch),i}return this._moveToNextUnitMatch(i),0}}FindReplaceModel=_ts_decorate([_ts_param(2,src.HCr),_ts_param(3,src.wTY),_ts_metadata("design:type",Function),_ts_metadata("design:paramtypes",[void 0===FindReplaceState?Object:FindReplaceState,"undefined"==typeof Set?Object:Set,void 0===src.HCr?Object:src.HCr,void 0===src.wTY?Object:src.wTY])],FindReplaceModel);var FindDirection=function(FindDirection){return FindDirection.ROW="row",FindDirection.COLUMN="column",FindDirection}({}),FindBy=function(FindBy){return FindBy.VALUE="value",FindBy.FORMULA="formula",FindBy}({}),FindScope=function(FindScope){return FindScope.SUBUNIT="subunit",FindScope.UNIT="unit",FindScope}({});class FindReplaceState{get state(){return this._state$.getValue()}get inputtingFindString(){return this._inputtingFindString}get findString(){return this._findString}get revealed(){return this._revealed}get replaceRevealed(){return this._replaceRevealed}get matchesPosition(){return this._matchesPosition}get matchesCount(){return this._matchesCount}get replaceString(){return this._replaceString}get caseSensitive(){return this._caseSensitive}get matchesTheWholeCell(){return this._matchesTheWholeCell}get findDirection(){return this._findDirection}get findScope(){return this._findScope}get findBy(){return this._findBy}get findCompleted(){return this._findCompleted}changeState(changes){let changed=!1;const changedState={};void 0!==changes.findString&&changes.findString!==this._findString&&(this._findString=changes.findString,changedState.findString=this._findString,changed=!0),void 0!==changes.revealed&&changes.revealed!==this._revealed&&(this._revealed=changes.revealed,changedState.revealed=changes.revealed,changed=!0),void 0!==changes.replaceRevealed&&changes.replaceRevealed!==this._replaceRevealed&&(this._replaceRevealed=changes.replaceRevealed,changedState.replaceRevealed=changes.replaceRevealed,changed=!0),void 0!==changes.replaceString&&changes.replaceString!==this._replaceString&&(this._replaceString=changes.replaceString,changedState.replaceString=changes.replaceString,changed=!0),void 0!==changes.matchesCount&&changes.matchesCount!==this._matchesCount&&(this._matchesCount=changes.matchesCount,changedState.matchesCount=changes.matchesCount,changed=!0),void 0!==changes.matchesPosition&&changes.matchesPosition!==this._matchesPosition&&(this._matchesPosition=changes.matchesPosition,changedState.matchesPosition=changes.matchesPosition,changed=!0),void 0!==changes.findBy&&changes.findBy!==this._findBy&&(this._findBy=changes.findBy,changedState.findBy=changes.findBy,changed=!0),void 0!==changes.findScope&&changes.findScope!==this._findScope&&(this._findScope=changes.findScope,changedState.findScope=changes.findScope,changed=!0),void 0!==changes.findDirection&&changes.findDirection!==this._findDirection&&(this._findDirection=changes.findDirection,changedState.findDirection=changes.findDirection,changed=!0),void 0!==changes.caseSensitive&&changes.caseSensitive!==this._caseSensitive&&(this._caseSensitive=changes.caseSensitive,changedState.caseSensitive=changes.caseSensitive,changed=!0),void 0!==changes.matchesTheWholeCell&&changes.matchesTheWholeCell!==this._matchesTheWholeCell&&(this._matchesTheWholeCell=changes.matchesTheWholeCell,changedState.matchesTheWholeCell=changes.matchesTheWholeCell,changed=!0),void 0!==changes.inputtingFindString&&changes.inputtingFindString!==this._inputtingFindString&&(this._inputtingFindString=changes.inputtingFindString,changedState.inputtingFindString=changes.inputtingFindString,changed=!0),void 0!==changes.findCompleted&&changes.findCompleted!==this._findCompleted&&(this._findCompleted=changes.findCompleted,changedState.findCompleted=changes.findCompleted,changed=!0),changed&&(this._state$.next({caseSensitive:this._caseSensitive,findBy:this._findBy,findCompleted:this._findCompleted,findDirection:this._findDirection,findScope:this._findScope,findString:this._findString,inputtingFindString:this._inputtingFindString,matchesCount:this._matchesCount,matchesPosition:this._matchesPosition,matchesTheWholeCell:this._matchesTheWholeCell,replaceRevealed:this._replaceRevealed,revealed:this._revealed}),this._stateUpdates$.next(changedState))}constructor(){this._stateUpdates$=new Subject.B,this.stateUpdates$=this._stateUpdates$.asObservable(),this._state$=new BehaviorSubject.t({caseSensitive:!1,findBy:"value",findCompleted:!1,findDirection:"row",findScope:"subunit",findString:"",inputtingFindString:"",matchesCount:0,matchesPosition:0,matchesTheWholeCell:!1,replaceRevealed:!1,replaceString:"",revealed:!0}),this.state$=this._state$.asObservable(),this._findString="",this._inputtingFindString="",this._replaceString="",this._revealed=!1,this._replaceRevealed=!1,this._matchesPosition=0,this._matchesCount=0,this._caseSensitive=!0,this._matchesTheWholeCell=!1,this._findDirection="row",this._findScope="subunit",this._findBy="value",this._findCompleted=!1}}class FindReplaceService extends src.jGt{get stateUpdates$(){return this._state.stateUpdates$}get state$(){return this._state.state$}get revealed(){return this._state.revealed}get replaceRevealed(){return this._state.replaceRevealed}constructor(_injector,_contextService){super(),this._injector=_injector,this._contextService=_contextService,this._providers=new Set,this._state=new FindReplaceState,this._currentMatch$=new BehaviorSubject.t(null),this.currentMatch$=this._currentMatch$.asObservable(),this._replaceables$=new BehaviorSubject.t([]),this.replaceables$=this._replaceables$.asObservable(),this._focusSignal$=new Subject.B,this.focusSignal$=this._focusSignal$.asObservable()}dispose(){super.dispose(),this._currentMatch$.next(null),this._currentMatch$.complete(),this._replaceables$.next([]),this._replaceables$.complete(),this._focusSignal$.complete()}getProviders(){return this._providers}getCurrentMatch(){return this._model?.getCurrentMatch()}getFindString(){return this._state.findString}changeFindString(findString){this._state.changeState({findString})}focusFindInput(){this._focusSignal$.next()}changeInputtingFindString(value){value?this._state.changeState({inputtingFindString:value}):this._state.changeState({inputtingFindString:"",findString:""})}changeReplaceString(replaceString){this._state.changeState({replaceString})}changeMatchesTheWholeCell(matchesTheWholeCell){this._state.changeState({matchesTheWholeCell})}changeCaseSensitive(caseSensitive){this._state.changeState({caseSensitive})}changeFindBy(findBy){this._state.changeState({findBy}),this._toggleDisplayRawFormula("formula"===findBy)}changeFindScope(scope){this._state.changeState({findScope:scope})}changeFindDirection(direction){this._state.changeState({findDirection:direction})}moveToNextMatch(){this._model&&(this._state.replaceRevealed&&!this._model.searched?(this._state.changeState({findString:this._state.inputtingFindString}),this._model.start()):this._model.moveToNextMatch(),this._focusSignal$.next())}moveToPreviousMatch(){this._model&&(this._state.replaceRevealed&&!this._model.searched?(this._state.changeState({findString:this._state.inputtingFindString}),this._model.start()):this._model.moveToPreviousMatch(),this._focusSignal$.next())}async replace(){return!!this._model&&this._model.replace()}async replaceAll(){if(!this._model)throw new Error("[FindReplaceService] replaceAll: model is not initialized!");return this._model.replaceAll()}revealReplace(){this._state.changeState({replaceRevealed:!0,inputtingFindString:this._state.findString}),this._toggleRevealReplace(!0)}focusSelection(){this._model?.focusSelection()}start(revealReplace=!1){if(0===this._providers.size)return!1;this._model=this._injector.createInstance(FindReplaceModel,this._state,this._providers),this._model.currentMatch$.subscribe((match=>this._currentMatch$.next(match))),this._model.replaceables$.subscribe((replaceables=>this._replaceables$.next(replaceables)));const newState={caseSensitive:!1,findBy:"value",findCompleted:!1,findDirection:"row",findScope:"subunit",findString:"",inputtingFindString:"",matchesCount:0,matchesPosition:0,matchesTheWholeCell:!1,replaceRevealed:!1,replaceString:"",revealed:!0};return revealReplace&&(newState.replaceRevealed=!0),this._state.changeState(newState),this._toggleRevealReplace(revealReplace),!0}find(){this._model?.start()}terminate(){this._model?.dispose(),this._model=null,this._toggleDisplayRawFormula(!1),this._toggleRevealReplace(!1)}registerFindReplaceProvider(provider){return this._providers.add(provider),(0,src.saO)((()=>this._providers.delete(provider)))}_toggleRevealReplace(revealReplace){this._contextService.setContextValue("FIND_REPLACE_REPLACE_REVEALED",revealReplace)}_toggleDisplayRawFormula(force){this._contextService.setContextValue(engine_render_src.he3,force)}}FindReplaceService=_ts_decorate([_ts_param(0,(0,src.y_5)(src.zZn)),_ts_param(1,src.oaf),_ts_metadata("design:type",Function),_ts_metadata("design:paramtypes",[void 0===src.zZn?Object:src.zZn,void 0===src.oaf?Object:src.oaf])],FindReplaceService);const ReplaceCurrentMatchCommand={id:"ui.command.replace-current-match",type:src.g4t.COMMAND,handler:accessor=>accessor.get(IFindReplaceService).replace()},ReplaceAllMatchesCommand={id:"ui.command.replace-all-matches",type:src.g4t.COMMAND,handler:async accessor=>{const confirmService=accessor.get(ui_src.rQ),localeService=accessor.get(src.iH9),messageService=accessor.get(ui_src.mX);if(!await confirmService.confirm({id:"CONFIRM_REPLACE_ALL",title:{title:localeService.t("find-replace.replace.confirm.title")},cancelText:localeService.t("button.cancel"),confirmText:localeService.t("button.confirm")}))return!1;const findReplaceService=accessor.get(IFindReplaceService),result=await findReplaceService.replaceAll(),{success,failure}=result;return failure>0?(0===success?messageService.show({type:design_src.Go.Error,content:localeService.t("find-replace.replace.all-failure")}):messageService.show({type:design_src.Go.Warning,content:localeService.t("find-replace.replace.partial-success",`${success}`,`${failure}`)}),!1):(messageService.show({type:design_src.Go.Success,content:localeService.t("find-replace.replace.all-success",`${success}`)}),!0)}},OpenFindDialogOperation={id:"ui.operation.open-find-dialog",type:src.g4t.OPERATION,handler:accessor=>{const findReplaceService=accessor.get(IFindReplaceService);return findReplaceService.revealed?findReplaceService.focusFindInput():findReplaceService.start(),!0}},OpenReplaceDialogOperation={id:"ui.operation.open-replace-dialog",type:src.g4t.OPERATION,handler:accessor=>{const findReplaceService=accessor.get(IFindReplaceService);return findReplaceService.revealed?findReplaceService.replaceRevealed?findReplaceService.focusFindInput():findReplaceService.revealReplace():findReplaceService.start(!0),!0}},GoToNextMatchOperation={type:src.g4t.OPERATION,id:"ui.operation.go-to-next-match",handler:accessor=>(accessor.get(IFindReplaceService).moveToNextMatch(),!0)},GoToPreviousMatchOperation={type:src.g4t.OPERATION,id:"ui.operation.go-to-previous-match",handler:accessor=>(accessor.get(IFindReplaceService).moveToPreviousMatch(),!0)},FocusSelectionOperation={type:src.g4t.OPERATION,id:"ui.operation.focus-selection",handler:accessor=>(accessor.get(IFindReplaceService).focusSelection(),!0)};var fromEvent=__webpack_require__("../../node_modules/.pnpm/rxjs@7.8.1/node_modules/rxjs/dist/esm5/internal/observable/fromEvent.js"),injectStylesIntoStyleTag=__webpack_require__("../../node_modules/.pnpm/style-loader@4.0.0_webpack@5.98.0_@swc+core@1.10.18_esbuild@0.25.0_/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),styleDomAPI=__webpack_require__("../../node_modules/.pnpm/style-loader@4.0.0_webpack@5.98.0_@swc+core@1.10.18_esbuild@0.25.0_/node_modules/style-loader/dist/runtime/styleDomAPI.js"),styleDomAPI_default=__webpack_require__.n(styleDomAPI),insertBySelector=__webpack_require__("../../node_modules/.pnpm/style-loader@4.0.0_webpack@5.98.0_@swc+core@1.10.18_esbuild@0.25.0_/node_modules/style-loader/dist/runtime/insertBySelector.js"),insertBySelector_default=__webpack_require__.n(insertBySelector),setAttributesWithoutAttributes=__webpack_require__("../../node_modules/.pnpm/style-loader@4.0.0_webpack@5.98.0_@swc+core@1.10.18_esbuild@0.25.0_/node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),setAttributesWithoutAttributes_default=__webpack_require__.n(setAttributesWithoutAttributes),insertStyleElement=__webpack_require__("../../node_modules/.pnpm/style-loader@4.0.0_webpack@5.98.0_@swc+core@1.10.18_esbuild@0.25.0_/node_modules/style-loader/dist/runtime/insertStyleElement.js"),insertStyleElement_default=__webpack_require__.n(insertStyleElement),styleTagTransform=__webpack_require__("../../node_modules/.pnpm/style-loader@4.0.0_webpack@5.98.0_@swc+core@1.10.18_esbuild@0.25.0_/node_modules/style-loader/dist/runtime/styleTagTransform.js"),styleTagTransform_default=__webpack_require__.n(styleTagTransform),FindReplaceDialog_module=__webpack_require__("../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.98.0_@swc+core@1.10.18_esbuild@0.25.0_/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[14].use[1]!../../node_modules/.pnpm/less-loader@12.2.0_less@4.2.2_webpack@5.98.0_@swc+core@1.10.18_esbuild@0.25.0_/node_modules/less-loader/dist/cjs.js??ruleSet[1].rules[14].use[2]!../../packages/find-replace/src/views/dialog/FindReplaceDialog.module.less"),options={};options.styleTagTransform=styleTagTransform_default(),options.setAttributes=setAttributesWithoutAttributes_default(),options.insert=insertBySelector_default().bind(null,"head"),options.domAPI=styleDomAPI_default(),options.insertStyleElement=insertStyleElement_default();injectStylesIntoStyleTag_default()(FindReplaceDialog_module.A,options);const dialog_FindReplaceDialog_module=FindReplaceDialog_module.A&&FindReplaceDialog_module.A.locals?FindReplaceDialog_module.A.locals:void 0;function SearchInput(props){const{findCompleted:findComplete,localeService,matchesCount,matchesPosition,findString,findReplaceService,onChange,...rest}=props,text=findComplete&&0===matchesCount?localeService.t("find-replace.dialog.no-result"):0===matchesCount?" ":void 0;return(0,jsx_runtime.jsx)(design_src.Dy,{autoFocus:!0,placeholder:localeService.t("find-replace.dialog.find-placeholder"),slot:(0,jsx_runtime.jsx)(design_src.is,{loop:!0,text,value:matchesPosition,total:matchesCount,onChange:newIndex=>{matchesPosition===matchesCount&&1===newIndex?findReplaceService.moveToNextMatch():1===matchesPosition&&newIndex===matchesCount||newIndex<matchesPosition?findReplaceService.moveToPreviousMatch():findReplaceService.moveToNextMatch()}}),value:findString,onChange:value=>onChange?.(value),...rest})}function useFindInputFocus(findReplaceService,ref){const focus=(0,react.useCallback)((()=>{document.querySelector(".univer-find-input input")?.focus()}),[]),selectHasFocus=(0,react.useCallback)((()=>{const allInputs=document.querySelectorAll(".univer-find-replace-dialog-container .univer-select-selection-search-input");return Array.from(allInputs).some((input=>input===document.activeElement))}),[]);return(0,react.useImperativeHandle)(ref,(()=>({focus,selectHasFocus}))),(0,react.useEffect)((()=>{const subscription=findReplaceService.focusSignal$.subscribe((()=>focus()));return()=>subscription.unsubscribe()}),[findReplaceService,focus]),{focus,selectHasFocus}}const FindDialog=(0,react.forwardRef)((function FindDialogImpl(_props,ref){const localeService=(0,ui_src.fJ)(src.iH9),findReplaceService=(0,ui_src.fJ)(IFindReplaceService),commandService=(0,ui_src.fJ)(src.wTY),state=(0,ui_src.J2)(findReplaceService.state$,void 0,!0),{findCompleted,findString,matchesCount,matchesPosition}=state,revealReplace=(0,react.useCallback)((()=>{commandService.executeCommand(OpenReplaceDialogOperation.id)}),[commandService]),onFindStringChange=(0,react.useCallback)((findString=>findReplaceService.changeFindString(findString)),[findReplaceService]);return useFindInputFocus(findReplaceService,ref),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(SearchInput,{findCompleted,className:"univer-find-input",matchesCount,matchesPosition,findReplaceService,localeService,findString,onChange:onFindStringChange}),(0,jsx_runtime.jsx)("div",{className:dialog_FindReplaceDialog_module.findReplaceExpandContainer,children:(0,jsx_runtime.jsx)(design_src.$n,{type:"text",size:"small",onClick:revealReplace,children:localeService.t("find-replace.dialog.advanced-finding")})})]})})),ReplaceDialog=(0,react.forwardRef)((function ReplaceDIalogImpl(_props,ref){const findReplaceService=(0,ui_src.fJ)(IFindReplaceService),localeService=(0,ui_src.fJ)(src.iH9),commandService=(0,ui_src.fJ)(src.wTY),messageService=(0,ui_src.fJ)(ui_src.mX),currentMatch=(0,ui_src.J2)(findReplaceService.currentMatch$,void 0,!0),replaceables=(0,ui_src.J2)(findReplaceService.replaceables$,void 0,!0),state=(0,ui_src.J2)(findReplaceService.state$,void 0,!0),{matchesCount,matchesPosition,findString,inputtingFindString,replaceString,caseSensitive,matchesTheWholeCell,findDirection,findScope,findBy,findCompleted}=state,findDisabled=0===inputtingFindString.length,replaceDisabled=0===matchesCount||!currentMatch?.replaceable,replaceAllDisabled=0===replaceables.length,onFindStringChange=(0,react.useCallback)((newValue=>findReplaceService.changeInputtingFindString(newValue)),[findReplaceService]),onReplaceStringChange=(0,react.useCallback)((replaceString=>findReplaceService.changeReplaceString(replaceString)),[findReplaceService]),{focus}=useFindInputFocus(findReplaceService,ref),onClickFindButton=(0,react.useCallback)((()=>{findString===inputtingFindString?findReplaceService.moveToNextMatch():(findReplaceService.changeFindString(inputtingFindString),findReplaceService.find())}),[findString,inputtingFindString,findReplaceService]),onClickReplaceButton=(0,react.useCallback)((()=>commandService.executeCommand(ReplaceCurrentMatchCommand.id)),[commandService]),onClickReplaceAllButton=(0,react.useCallback)((async()=>{await commandService.executeCommand(ReplaceAllMatchesCommand.id),focus()}),[commandService]),onChangeFindDirection=(0,react.useCallback)((findDirection=>{findReplaceService.changeFindDirection(findDirection)}),[findReplaceService]),onChangeFindScope=(0,react.useCallback)((findScope=>{findReplaceService.changeFindScope(findScope)}),[findReplaceService]),onChangeFindBy=(0,react.useCallback)((findBy=>{findReplaceService.changeFindBy(findBy)}),[findReplaceService]),findScopeOptions=function useFindScopeOptions(localeService){const locale=localeService.getCurrentLocale(),options=(0,react.useMemo)((()=>[{label:localeService.t("find-replace.dialog.find-scope.current-sheet"),value:FindScope.SUBUNIT},{label:localeService.t("find-replace.dialog.find-scope.workbook"),value:FindScope.UNIT}]),[locale]);return options}(localeService),findDirectionOptions=function useFindDirectionOptions(localeService){const locale=localeService.getCurrentLocale(),options=(0,react.useMemo)((()=>[{label:localeService.t("find-replace.dialog.find-direction.row"),value:FindDirection.ROW},{label:localeService.t("find-replace.dialog.find-direction.column"),value:FindDirection.COLUMN}]),[locale]);return options}(localeService),findByOptions=function useFindByOptions(localeService){const locale=localeService.getCurrentLocale(),options=(0,react.useMemo)((()=>[{label:localeService.t("find-replace.dialog.find-by.value"),value:FindBy.VALUE},{label:localeService.t("find-replace.dialog.find-by.formula"),value:FindBy.FORMULA}]),[locale]);return options}(localeService);return(0,react.useEffect)((()=>{findCompleted&&0===matchesCount&&messageService.show({content:localeService.t("find-replace.dialog.no-match"),type:design_src.Go.Warning,duration:5e3})}),[findCompleted,matchesCount,messageService,localeService]),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(design_src.Hb,{label:localeService.t("find-replace.dialog.find"),children:(0,jsx_runtime.jsx)(SearchInput,{findCompleted,className:"univer-find-input",matchesCount,matchesPosition,findReplaceService,localeService,findString:inputtingFindString,onChange:onFindStringChange})}),(0,jsx_runtime.jsx)(design_src.Hb,{label:localeService.t("find-replace.dialog.replace"),children:(0,jsx_runtime.jsx)(design_src.pd,{placeholder:localeService.t("find-replace.dialog.replace-placeholder"),value:replaceString,onChange:value=>onReplaceStringChange(value)})}),(0,jsx_runtime.jsx)(design_src.Hb,{label:localeService.t("find-replace.dialog.find-direction.title"),children:(0,jsx_runtime.jsx)(design_src.l6,{value:findDirection,options:findDirectionOptions,onChange:onChangeFindDirection})}),(0,jsx_runtime.jsx)(design_src.Hp,{children:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(design_src.Hb,{label:localeService.t("find-replace.dialog.find-scope.title"),children:(0,jsx_runtime.jsx)(design_src.l6,{value:findScope,options:findScopeOptions,onChange:onChangeFindScope})}),(0,jsx_runtime.jsx)(design_src.Hb,{label:localeService.t("find-replace.dialog.find-by.title"),children:(0,jsx_runtime.jsx)(design_src.l6,{value:findBy,options:findByOptions,onChange:onChangeFindBy})})]})}),(0,jsx_runtime.jsx)(design_src.Hp,{children:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(design_src.Hb,{children:(0,jsx_runtime.jsx)(design_src.Sc,{checked:caseSensitive,onChange:checked=>{findReplaceService.changeCaseSensitive(checked)},children:localeService.t("find-replace.dialog.case-sensitive")})}),(0,jsx_runtime.jsx)(design_src.Hb,{children:(0,jsx_runtime.jsx)(design_src.Sc,{checked:matchesTheWholeCell,onChange:checked=>{findReplaceService.changeMatchesTheWholeCell(checked)},children:localeService.t("find-replace.dialog.match-the-whole-cell")})})]})}),(0,jsx_runtime.jsxs)("div",{className:dialog_FindReplaceDialog_module.findReplaceButtonsGroup,children:[(0,jsx_runtime.jsx)(design_src.$n,{type:"primary",onClick:onClickFindButton,disabled:findDisabled,children:localeService.t("find-replace.dialog.find")}),(0,jsx_runtime.jsxs)("span",{className:dialog_FindReplaceDialog_module.findReplaceButtonsGroupRight,children:[(0,jsx_runtime.jsx)(design_src.$n,{disabled:replaceDisabled,onClick:onClickReplaceButton,children:localeService.t("find-replace.dialog.replace")}),(0,jsx_runtime.jsx)(design_src.$n,{disabled:replaceAllDisabled,onClick:onClickReplaceAllButton,children:localeService.t("find-replace.dialog.replace-all")})]})]})]})}));function FindReplaceDialog(){const findReplaceService=(0,ui_src.fJ)(IFindReplaceService),layoutService=(0,ui_src.fJ)(ui_src.xQ),contextService=(0,ui_src.fJ)(src.oaf),state=(0,ui_src.J2)(findReplaceService.state$,void 0,!0),dialogContainerRef=(0,react.useRef)(null);(0,react.useEffect)((()=>{let disposable;return dialogContainerRef.current&&(disposable=layoutService.registerContainerElement(dialogContainerRef.current)),()=>disposable?.dispose()}),[layoutService]);const focusRef=(0,react.useRef)(null),setDialogContainerFocus=(0,react.useCallback)((focused=>contextService.setContextValue("FIND_REPLACE_DIALOG_FOCUS",focused)),[contextService]),setDialogInputFocus=(0,react.useCallback)((focused=>contextService.setContextValue("FIND_REPLACE_INPUT_FOCUS",focused)),[contextService]);return(0,react.useEffect)((()=>{const focusSubscription=(0,fromEvent.R)(document,"focusin").subscribe((event=>{event.target&&dialogContainerRef.current?.contains(event.target)?setDialogContainerFocus(!0):setDialogContainerFocus(!1),focusRef.current&&focusRef.current.selectHasFocus()?setDialogInputFocus(!1):setDialogInputFocus(!0)}));return focusRef.current?.focus(),setDialogContainerFocus(!0),setDialogInputFocus(!0),()=>{focusSubscription.unsubscribe(),setDialogContainerFocus(!1)}}),[setDialogContainerFocus,setDialogInputFocus]),(0,jsx_runtime.jsx)("div",{className:dialog_FindReplaceDialog_module.findReplaceDialogContainer,ref:dialogContainerRef,children:state.replaceRevealed?(0,jsx_runtime.jsx)(ReplaceDialog,{ref:focusRef}):(0,jsx_runtime.jsx)(FindDialog,{ref:focusRef})})}function whenFindReplaceDialogFocused(contextService){return contextService.getContextValue("FIND_REPLACE_DIALOG_FOCUS")}function whenFindReplaceInputFocused(contextService){return contextService.getContextValue("FIND_REPLACE_INPUT_FOCUS")}FindDialog.__docgenInfo={description:"",methods:[],displayName:"FindDialog"},ReplaceDialog.__docgenInfo={description:"",methods:[],displayName:"ReplaceDialog"},FindReplaceDialog.__docgenInfo={description:"",methods:[],displayName:"FindReplaceDialog"};function whenSheetFocused(contextService){return contextService.getContextValue(src.xU)}function whenEditorNotActivated(contextService){return!contextService.getContextValue(src.AF$)}const OpenFindDialogShortcutItem={id:OpenFindDialogOperation.id,description:"find-replace.shortcut.open-find-dialog",binding:ui_src.DD.F|ui_src.SK.CTRL_COMMAND,group:"7_find-replace-shortcuts",preconditions:contextService=>!whenFindReplaceDialogFocused(contextService)&&whenSheetFocused(contextService)&&whenEditorNotActivated(contextService)},MacOpenFindDialogShortcutItem={id:OpenFindDialogOperation.id,description:"find-replace.shortcut.open-find-dialog",binding:ui_src.DD.F|ui_src.SK.CTRL_COMMAND,mac:ui_src.DD.F|ui_src.SK.MAC_CTRL,preconditions:contextService=>!whenFindReplaceDialogFocused(contextService)&&whenSheetFocused(contextService)&&whenEditorNotActivated(contextService)},OpenReplaceDialogShortcutItem={id:OpenReplaceDialogOperation.id,description:"find-replace.shortcut.open-replace-dialog",binding:ui_src.DD.H|ui_src.SK.CTRL_COMMAND,mac:ui_src.DD.H|ui_src.SK.MAC_CTRL,group:"7_find-replace-shortcuts",preconditions:contextService=>whenSheetFocused(contextService)&&whenEditorNotActivated(contextService)&&(!whenFindReplaceDialogFocused(contextService)||!function whenReplaceRevealed(contextService){return contextService.getContextValue("FIND_REPLACE_REPLACE_REVEALED")}(contextService))},GoToNextFindMatchShortcutItem={id:GoToNextMatchOperation.id,description:"find-replace.shortcut.go-to-next-match",binding:ui_src.DD.ENTER,group:"7_find-replace-shortcuts",priority:1e3,preconditions:contextService=>whenFindReplaceInputFocused(contextService)&&whenFindReplaceDialogFocused(contextService)},GoToPreviousFindMatchShortcutItem={id:GoToPreviousMatchOperation.id,description:"find-replace.shortcut.go-to-previous-match",binding:ui_src.DD.ENTER|ui_src.SK.SHIFT,group:"7_find-replace-shortcuts",priority:1e3,preconditions:contextService=>whenFindReplaceInputFocused(contextService)&&whenFindReplaceDialogFocused(contextService)},FocusSelectionShortcutItem={id:FocusSelectionOperation.id,description:"find-replace.shortcut.focus-selection",binding:ui_src.DD.ESC,group:"7_find-replace-shortcuts",priority:1e3,preconditions:contextService=>whenFindReplaceDialogFocused(contextService)};var map=__webpack_require__("../../node_modules/.pnpm/rxjs@7.8.1/node_modules/rxjs/dist/esm5/internal/operators/map.js");const menuSchema={[ui_src.My.OTHERS]:{[OpenFindDialogOperation.id]:{order:2,menuItemFactory:function FindReplaceMenuItemFactory(accessor){const contextService=accessor.get(src.oaf);return{id:OpenFindDialogOperation.id,icon:"SearchIcon",tooltip:"find-replace.toolbar",type:ui_src.xU.BUTTON,hidden$:(0,ui_src.fN)(accessor,src.Zy$.UNIVER_SHEET),disabled$:(0,combineLatest.z)([contextService.subscribeContextValue$(src.AF$),contextService.subscribeContextValue$(src.xU)]).pipe((0,map.T)((([editorActivated,focusingSheet])=>editorActivated||!focusingSheet)))}}}}};function find_replace_controller_ts_metadata(k,v){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(k,v)}function find_replace_controller_ts_param(paramIndex,decorator){return function(target,key){decorator(target,key,paramIndex)}}class FindReplaceController extends src.hy_{constructor(_univerInstanceService,_menuManagerService,_shortcutService,_commandService,_findReplaceService,_dialogService,_layoutService,_localeService,_componentManager,_injector){super(),this._univerInstanceService=_univerInstanceService,this._menuManagerService=_menuManagerService,this._shortcutService=_shortcutService,this._commandService=_commandService,this._findReplaceService=_findReplaceService,this._dialogService=_dialogService,this._layoutService=_layoutService,this._localeService=_localeService,this._componentManager=_componentManager,this._injector=_injector,this._initCommands(),this._initUI(),this._initShortcuts()}dispose(){super.dispose(),this._closingListenerDisposable?.dispose(),this._closingListenerDisposable=null}_initCommands(){[OpenFindDialogOperation,OpenReplaceDialogOperation,GoToNextMatchOperation,GoToPreviousMatchOperation,ReplaceAllMatchesCommand,ReplaceCurrentMatchCommand,FocusSelectionOperation].forEach((c=>{this.disposeWithMe(this._commandService.registerCommand(c))}))}_initShortcuts(){[OpenReplaceDialogShortcutItem,OpenFindDialogShortcutItem,MacOpenFindDialogShortcutItem,GoToPreviousFindMatchShortcutItem,GoToNextFindMatchShortcutItem,FocusSelectionShortcutItem].forEach((s=>this.disposeWithMe(this._shortcutService.registerShortcut(s))))}_initUI(){this.disposeWithMe(this._componentManager.register("FindReplaceDialog",FindReplaceDialog)),this.disposeWithMe(this._componentManager.register("SearchIcon",search_single)),this._menuManagerService.mergeMenu(menuSchema),this._findReplaceService.stateUpdates$.pipe((0,takeUntil.Q)(this.dispose$)).subscribe((newState=>{!0===newState.revealed&&this._openPanel()}))}_openPanel(){this._dialogService.open({id:"DESKTOP_FIND_REPLACE_DIALOG",draggable:!0,width:350,title:{title:this._localeService.t("find-replace.dialog.title")},children:{label:"FindReplaceDialog"},destroyOnClose:!0,defaultPosition:getFindReplaceDialogDefaultPosition(),preservePositionOnDestroy:!0,onClose:()=>this.closePanel()}),this._closingListenerDisposable=(0,src.saO)(this._univerInstanceService.focused$.pipe((0,takeUntil.Q)(this.dispose$)).subscribe((focused=>{focused&&this._univerInstanceService.getUniverSheetInstance(focused)||this.closePanel()})))}closePanel(){this._closingListenerDisposable&&(this._closingListenerDisposable.dispose(),this._closingListenerDisposable=null,this._dialogService.close("DESKTOP_FIND_REPLACE_DIALOG"),this._findReplaceService.terminate(),queueMicrotask((()=>this._layoutService.focus())))}}function getFindReplaceDialogDefaultPosition(){const{innerWidth}=window;return{x:(innerWidth-350)/2-20,y:-90}}FindReplaceController=function find_replace_controller_ts_decorate(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r}([find_replace_controller_ts_param(0,src.HCr),find_replace_controller_ts_param(1,ui_src.Zi),find_replace_controller_ts_param(2,ui_src.nF),find_replace_controller_ts_param(3,src.wTY),find_replace_controller_ts_param(4,IFindReplaceService),find_replace_controller_ts_param(5,ui_src.Xw),find_replace_controller_ts_param(6,ui_src.xQ),find_replace_controller_ts_param(7,(0,src.y_5)(src.iH9)),find_replace_controller_ts_param(8,(0,src.y_5)(ui_src.BJ)),find_replace_controller_ts_param(9,(0,src.y_5)(src.zZn)),find_replace_controller_ts_metadata("design:type",Function),find_replace_controller_ts_metadata("design:paramtypes",[void 0===src.HCr?Object:src.HCr,void 0===ui_src.Zi?Object:ui_src.Zi,void 0===ui_src.nF?Object:ui_src.nF,void 0===src.wTY?Object:src.wTY,void 0===IFindReplaceService?Object:IFindReplaceService,void 0===ui_src.Xw?Object:ui_src.Xw,void 0===ui_src.xQ?Object:ui_src.xQ,void 0===src.iH9?Object:src.iH9,void 0===ui_src.BJ?Object:ui_src.BJ,void 0===src.zZn?Object:src.zZn])],FindReplaceController);const en_US={"find-replace":{toolbar:"Find & Replace",shortcut:{"open-find-dialog":"Open Find Dialog","open-replace-dialog":"Open Replace Dialog","close-dialog":"Close Find & Replace Dialog","go-to-next-match":"Go to Next Match","go-to-previous-match":"Go to Previous Match","focus-selection":"Focus Selection"},dialog:{title:"Find",find:"Find",replace:"Replace","replace-all":"Replace All","case-sensitive":"Case Sensitive","find-placeholder":"Find in this Sheet","advanced-finding":"Advanced Searching & Replace","replace-placeholder":"Input Replace String","match-the-whole-cell":"Match the Whole Cell","find-direction":{title:"Find Direction",row:"Search by Row",column:"Search by Column"},"find-scope":{title:"Find Range","current-sheet":"Current Sheet",workbook:"Workbook"},"find-by":{title:"Find By",value:"Find by Value",formula:"Find Formula"},"no-match":"Finding completed but no match found.","no-result":"No Result"},replace:{"all-success":"Replaced all {0} matches","all-failure":"Replace failed",confirm:{title:"Are you sure to replace all matches?"}}},"find-replace-shortcuts":"Find & Replace"},ru_RU={"find-replace":{toolbar:"Найти и заменить",shortcut:{"open-find-dialog":"Открыть диалог поиска","open-replace-dialog":"Открыть диалог замены","close-dialog":"Закрыть диалог поиска и замены","go-to-next-match":"Перейти к следующему совпадению","go-to-previous-match":"Перейти к предыдущему совпадению","focus-selection":"Фокус на выделении"},dialog:{title:"Найти",find:"Найти",replace:"Заменить","replace-all":"Заменить все","case-sensitive":"С учетом регистра","find-placeholder":"Найти в этом листе","advanced-finding":"Расширенный поиск и замена","replace-placeholder":"Введите строку для замены","match-the-whole-cell":"Точное совпадение","find-direction":{title:"Направление поиска",row:"Поиск по строкам",column:"Поиск по столбцам"},"find-scope":{title:"Область поиска","current-sheet":"Текущий лист",workbook:"Книга"},"find-by":{title:"Поиск по",value:"Поиск по значению",formula:"Поиск по формуле"},"no-match":"Поиск завершен, совпадений не найдено.","no-result":"Нет результатов"},replace:{"all-success":"Заменены все {0} совпадений","all-failure":"Не удалось заменить",confirm:{title:"Вы уверены, что хотите заменить все совпадения?"}}},"find-replace-shortcuts":"Найти и заменить"},zh_CN={"find-replace":{toolbar:"查找替换",shortcut:{"open-find-dialog":"打开查找对话框","open-replace-dialog":"打开替换对话框","close-dialog":"关闭查找替换对话框","go-to-next-match":"下一个匹配项","go-to-previous-match":"下一个匹配项","focus-selection":"聚焦选区"},dialog:{title:"查找",find:"查找",replace:"替换","replace-all":"替换全部","find-placeholder":"输入查找内容","advanced-finding":"替换 / 高级查找","replace-placeholder":"输入替换内容","case-sensitive":"匹配大小写","match-the-whole-cell":"匹配整个单元格","find-scope":{title:"查找范围","current-sheet":"当前子表",workbook:"整个工作簿"},"find-direction":{title:"查找顺序",column:"按列查找",row:"按行查找"},"find-by":{title:"查找方式",formula:"查找公式",value:"查找值"},"no-match":"已完成搜索，但是未找到任何匹配项","no-result":"无结果"},replace:{"all-success":"已全部替换 {0} 个匹配项","all-failure":"替换失败",confirm:{title:"确定要替换所有的匹配项吗？"}}},"find-replace-shortcuts":"查找替换"},FindReplaceDialog_stories={title:"Find Replace Dialog",parameters:{layout:"centered"},tags:["autodocs"]};function FindDialogDemo(){const{injector}=(0,react.useContext)(ui_src.WZ),[inject]=(0,react.useState)((()=>{const deps=[[IFindReplaceService,{useClass:FindReplaceService}],[ui_src.xQ,{useClass:ui_src.Ux}],[FindReplaceController]];return injector?.get(src.iH9).load({[src.VnV.EN_US]:en_US,[src.VnV.ZH_CN]:zh_CN,[src.VnV.RU_RU]:ru_RU}),deps.forEach((dependency=>injector?.add(dependency))),injector})),memoizedValue=(0,react.useMemo)((()=>({injector:inject})),[inject]);return(0,jsx_runtime.jsx)(ui_src.WZ.Provider,{value:memoizedValue,children:(0,jsx_runtime.jsx)(FindReplaceDialog,{})})}const FindReplaceDialog_stories_FindDialog={render:()=>(0,jsx_runtime.jsx)(FindDialogDemo,{})};function ReplaceDialogDemo(){const{injector}=(0,react.useContext)(ui_src.WZ),[inject]=(0,react.useState)((()=>{const deps=[[IFindReplaceService,{useClass:FindReplaceService}],[ui_src.xQ,{useClass:ui_src.Ux}],[FindReplaceController]];return injector?.get(src.iH9).load({[src.VnV.EN_US]:en_US,[src.VnV.ZH_CN]:zh_CN,[src.VnV.RU_RU]:ru_RU}),deps.forEach((dependency=>injector?.add(dependency))),injector})),memoizedValue=(0,react.useMemo)((()=>({injector:inject})),[inject]);return(0,jsx_runtime.jsx)(ui_src.WZ.Provider,{value:memoizedValue,children:(0,jsx_runtime.jsx)(FindReplaceDialog,{})})}const FindReplaceDialog_stories_ReplaceDialog={render:()=>(0,jsx_runtime.jsx)(ReplaceDialogDemo,{})},__namedExportsOrder=["FindDialog","ReplaceDialog"];FindReplaceDialog_stories_FindDialog.parameters={...FindReplaceDialog_stories_FindDialog.parameters,docs:{...FindReplaceDialog_stories_FindDialog.parameters?.docs,source:{originalSource:"{\n  render() {\n    return <FindDialogDemo />;\n  }\n}",...FindReplaceDialog_stories_FindDialog.parameters?.docs?.source}}},FindReplaceDialog_stories_ReplaceDialog.parameters={...FindReplaceDialog_stories_ReplaceDialog.parameters,docs:{...FindReplaceDialog_stories_ReplaceDialog.parameters?.docs,source:{originalSource:"{\n  render() {\n    return <ReplaceDialogDemo />;\n  }\n}",...FindReplaceDialog_stories_ReplaceDialog.parameters?.docs?.source}}}}}]);