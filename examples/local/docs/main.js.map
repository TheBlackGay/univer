{
  "version": 3,
  "sources": ["../../../packages/docs-hyper-link/src/commands/mutations/hyper-link.mutation.ts", "../../../packages/docs-hyper-link/src/controllers/config.schema.ts", "../../../packages/docs-hyper-link/src/controllers/resource.controller.ts", "../../../packages/docs-hyper-link/src/plugin.ts", "../../../packages/docs-hyper-link-ui/src/controllers/config.schema.ts", "../../../packages/docs-hyper-link-ui/src/views/hyper-link-edit/index.tsx", "../../../packages/docs-hyper-link-ui/src/commands/commands/add-link.command.ts", "../../../packages/docs-hyper-link-ui/src/commands/commands/update-link.command.ts", "/Users/zhongjiafeng/Desktop/5000_Project/github/univer/packages/docs-hyper-link-ui/src/views/hyper-link-edit/index.module.less", "../../../packages/docs-hyper-link-ui/src/commands/commands/delete-link.command.ts", "../../../packages/docs-hyper-link-ui/src/commands/operations/popup.operation.ts", "/Users/zhongjiafeng/Desktop/5000_Project/github/univer/packages/docs-hyper-link-ui/src/views/hyper-link-popup/index.module.less", "../../../packages/docs-hyper-link-ui/src/views/hyper-link-popup/index.tsx", "../../../packages/docs-hyper-link-ui/src/services/hyper-link-popup.service.ts", "../../../packages/docs-hyper-link-ui/src/controllers/doc-hyper-link-selection.controller.ts", "../../../packages/docs-hyper-link-ui/src/controllers/render-controllers/hyper-link-event.render-controller.ts", "../../../packages/docs-hyper-link-ui/src/controllers/render-controllers/render.controller.ts", "../../../packages/docs-hyper-link-ui/src/controllers/menu.ts", "../../../packages/docs-hyper-link-ui/src/controllers/menu.schema.ts", "../../../packages/docs-hyper-link-ui/src/controllers/ui.controller.ts", "../../../packages/docs-hyper-link-ui/src/types/const/index.ts", "../../../packages/docs-hyper-link-ui/src/plugin.ts", "../../../packages/docs-quick-insert-ui/src/commands/commands/doc-quick-insert.command.ts", "../../../packages/docs-quick-insert-ui/src/views/KeywordInputPlaceholder.tsx", "../../../packages/docs-quick-insert-ui/src/views/QuickInsertPopup.tsx", "../../../packages/docs-quick-insert-ui/src/views/QuickInsertPlaceholder.tsx", "../../../packages/docs-quick-insert-ui/src/services/doc-quick-insert-popup.service.ts", "../../../packages/docs-quick-insert-ui/src/commands/operations/quick-insert-popup.operation.ts", "../../../packages/docs-quick-insert-ui/src/controllers/built-in-menus.ts", "../../../packages/docs-quick-insert-ui/src/controllers/doc-quick-insert-trigger.controller.ts", "../../../packages/docs-quick-insert-ui/src/controllers/doc-quick-insert-ui.controller.ts", "../../../packages/docs-quick-insert-ui/src/plugin.ts", "../../../packages/docs-thread-comment-ui/src/common/const.ts", "../../../packages/docs-thread-comment-ui/src/controllers/config.schema.ts", "../../../packages/docs-thread-comment-ui/src/services/doc-thread-comment.service.ts", "../../../packages/docs-thread-comment-ui/src/views/doc-thread-comment-panel/index.tsx", "../../../packages/docs-thread-comment-ui/src/commands/commands/add-doc-comment.command.ts", "../../../packages/docs-thread-comment-ui/src/commands/commands/delete-doc-comment.command.ts", "../../../packages/docs-thread-comment-ui/src/controllers/menu.ts", "../../../packages/docs-thread-comment-ui/src/commands/operations/show-comment-panel.operation.ts", "../../../packages/docs-thread-comment-ui/src/controllers/doc-thread-comment-selection.controller.ts", "../../../packages/docs-thread-comment-ui/src/controllers/menu.schema.ts", "../../../packages/docs-thread-comment-ui/src/controllers/doc-thread-comment-ui.controller.ts", "../../../packages/docs-thread-comment-ui/src/controllers/render-controllers/render.controller.ts", "../../../packages/docs-thread-comment-ui/src/plugin.ts", "../../src/docs/main.ts"],
  "sourcesContent": ["/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CommandType, type ICommand } from '@univerjs/core';\n\nexport const AddHyperLinkMuatation: ICommand = {\n    id: 'docs.mutation.add-hyper-link',\n    type: CommandType.MUTATION,\n    handler: () => {\n        return true;\n    },\n};\n\nexport const UpdateHyperLinkMuatation: ICommand = {\n    id: 'docs.mutation.update-hyper-link',\n    type: CommandType.MUTATION,\n    handler: () => {\n        return true;\n    },\n};\n\nexport const DeleteHyperLinkMuatation: ICommand = {\n    id: 'docs.mutation.delete-hyper-link',\n    type: CommandType.MUTATION,\n    handler: () => {\n        return true;\n    },\n};\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const DOCS_HYPER_LINK_PLUGIN_CONFIG_KEY = 'docs-hyper-link.config';\n\nexport const configSymbol = Symbol(DOCS_HYPER_LINK_PLUGIN_CONFIG_KEY);\n\nexport interface IUniverDocsHyperLinkConfig {\n}\n\nexport const defaultPluginConfig: IUniverDocsHyperLinkConfig = {};\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { DocumentDataModel, ICustomRange } from '@univerjs/core';\nimport { CustomRangeType, Disposable, Inject, IResourceManagerService, IUniverInstanceService, UniverInstanceType } from '@univerjs/core';\n\nexport const DOC_HYPER_LINK_PLUGIN = 'DOC_HYPER_LINK_PLUGIN';\n\ninterface IDocHyperLinkJSON {\n    links: { id: string; payload: string }[];\n}\n\nexport class DocHyperLinkResourceController extends Disposable {\n    constructor(\n        @Inject(IResourceManagerService) private readonly _resourceManagerService: IResourceManagerService,\n        @IUniverInstanceService private readonly _univerInstanceService: IUniverInstanceService\n    ) {\n        super();\n        this._init();\n    }\n\n    private _init() {\n        this._resourceManagerService.registerPluginResource({\n            pluginName: DOC_HYPER_LINK_PLUGIN,\n            businesses: [UniverInstanceType.UNIVER_DOC],\n            onLoad: (unitID: string, resource: IDocHyperLinkJSON) => {\n                const doc = this._univerInstanceService.getUnit<DocumentDataModel>(unitID, UniverInstanceType.UNIVER_DOC);\n                if (!doc) {\n                    return;\n                }\n\n                const customRangeMap = new Map<string, ICustomRange>();\n\n                const handleDoc = (model: DocumentDataModel) => {\n                    model.getBody()?.customRanges?.forEach((customRange) => {\n                        if (customRange.rangeType === CustomRangeType.HYPERLINK) {\n                            customRangeMap.set(customRange.rangeId, customRange);\n                        }\n                    });\n                    return customRangeMap;\n                };\n                doc.headerModelMap.forEach((headerModel) => {\n                    handleDoc(headerModel);\n                });\n                doc.footerModelMap.forEach((footerModel) => {\n                    handleDoc(footerModel);\n                });\n                handleDoc(doc);\n\n                resource.links.forEach((link) => {\n                    const customRange = customRangeMap.get(link.id);\n                    if (customRange) {\n                        customRange.properties = {\n                            ...customRange.properties,\n                            url: link.payload,\n                        };\n                    }\n                });\n            },\n            onUnLoad: (unitID: string) => {},\n            toJson: (unitID: string) => {\n                const doc = this._univerInstanceService.getUnit<DocumentDataModel>(unitID, UniverInstanceType.UNIVER_DOC);\n                const links: { id: string; payload: string }[] = [];\n                if (doc) {\n                    const handleDoc = (model: DocumentDataModel) => {\n                        model.getBody()?.customRanges?.forEach((customRange) => {\n                            if (customRange.rangeType === CustomRangeType.HYPERLINK) {\n                                links.push({\n                                    id: customRange.rangeId,\n                                    payload: customRange.properties?.url || '',\n                                });\n                            }\n                        });\n                    };\n                    doc.headerModelMap.forEach((headerModel) => {\n                        handleDoc(headerModel);\n                    });\n                    doc.footerModelMap.forEach((footerModel) => {\n                        handleDoc(footerModel);\n                    });\n                    handleDoc(doc);\n                }\n\n                return JSON.stringify({ links });\n            },\n            parseJson(bytes: string): IDocHyperLinkJSON {\n                return JSON.parse(bytes);\n            },\n        });\n    }\n}\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Dependency } from '@univerjs/core';\nimport type { IUniverDocsHyperLinkConfig } from './controllers/config.schema';\nimport { ICommandService, IConfigService, Inject, Injector, merge, Plugin, UniverInstanceType } from '@univerjs/core';\nimport { AddHyperLinkMuatation, DeleteHyperLinkMuatation, UpdateHyperLinkMuatation } from './commands/mutations/hyper-link.mutation';\nimport { defaultPluginConfig, DOCS_HYPER_LINK_PLUGIN_CONFIG_KEY } from './controllers/config.schema';\nimport { DOC_HYPER_LINK_PLUGIN, DocHyperLinkResourceController } from './controllers/resource.controller';\n\nexport class UniverDocsHyperLinkPlugin extends Plugin {\n    static override pluginName = DOC_HYPER_LINK_PLUGIN;\n    static override type = UniverInstanceType.UNIVER_DOC;\n\n    constructor(\n        private readonly _config: Partial<IUniverDocsHyperLinkConfig> = defaultPluginConfig,\n        @Inject(Injector) protected override _injector: Injector,\n        @IConfigService private readonly _configService: IConfigService,\n        @ICommandService private readonly _commandService: ICommandService\n    ) {\n        super();\n\n        // Manage the plugin configuration.\n        const { ...rest } = merge(\n            {},\n            defaultPluginConfig,\n            this._config\n        );\n        this._configService.setConfig(DOCS_HYPER_LINK_PLUGIN_CONFIG_KEY, rest);\n    }\n\n    override onStarting(): void {\n        const deps: Dependency[] = [[DocHyperLinkResourceController]];\n        deps.forEach((dep) => this._injector.add(dep));\n\n        [AddHyperLinkMuatation, DeleteHyperLinkMuatation, UpdateHyperLinkMuatation].forEach((mutation) => {\n            this.disposeWithMe(this._commandService.registerCommand(mutation));\n        });\n\n        this._injector.get(DocHyperLinkResourceController);\n    }\n}\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { MenuConfig } from '@univerjs/ui';\n\nexport const DOCS_HYPER_LINK_UI_PLUGIN_CONFIG_KEY = 'docs-hyper-link-ui.config';\n\nexport const configSymbol = Symbol(DOCS_HYPER_LINK_UI_PLUGIN_CONFIG_KEY);\n\nexport interface IUniverDocsHyperLinkUIConfig {\n    menu?: MenuConfig;\n}\n\nexport const defaultPluginConfig: IUniverDocsHyperLinkUIConfig = {};\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { DocumentDataModel } from '@univerjs/core';\nimport { BuildTextUtils, getBodySlice, ICommandService, IUniverInstanceService, LocaleService, Tools, UniverInstanceType } from '@univerjs/core';\nimport { Button, FormLayout, Input } from '@univerjs/design';\nimport { DocSelectionManagerService } from '@univerjs/docs';\nimport { KeyCode, useDependency, useObservable } from '@univerjs/ui';\nimport React, { useEffect, useState } from 'react';\nimport { AddDocHyperLinkCommand } from '../../commands/commands/add-link.command';\nimport { UpdateDocHyperLinkCommand } from '../../commands/commands/update-link.command';\nimport { DocHyperLinkPopupService } from '../../services/hyper-link-popup.service';\nimport styles from './index.module.less';\n\nfunction hasProtocol(urlString: string) {\n    const pattern = /^[a-zA-Z]+:\\/\\//;\n    return pattern.test(urlString);\n}\n\nfunction isEmail(url: string) {\n    const pattern = /^[\\w-\\.]+@([\\w-]+\\.)+[\\w-]{2,4}$/;\n    return pattern.test(url);\n}\n\nfunction transformUrl(urlStr: string) {\n    return hasProtocol(urlStr) ? urlStr : isEmail(urlStr) ? `mailto://${urlStr}` : `https://${urlStr}`;\n}\n\nexport const DocHyperLinkEdit = () => {\n    const hyperLinkService = useDependency(DocHyperLinkPopupService);\n    const localeService = useDependency(LocaleService);\n    const editing = useObservable(hyperLinkService.editingLink$);\n    const commandService = useDependency(ICommandService);\n    const univerInstanceService = useDependency(IUniverInstanceService);\n\n    const docSelectionManagerService = useDependency(DocSelectionManagerService);\n    const [link, setLink] = useState('');\n    const [label, setLabel] = useState('');\n    const [showError, setShowError] = useState(false);\n    const isLegal = Tools.isLegalUrl(link);\n    const doc = editing\n        ? univerInstanceService.getUnit<DocumentDataModel>(editing.unitId, UniverInstanceType.UNIVER_DOC) :\n        univerInstanceService.getCurrentUnitForType<DocumentDataModel>(UniverInstanceType.UNIVER_DOC);\n\n    useEffect(() => {\n        const activeRange = docSelectionManagerService.getActiveTextRange();\n        if (!activeRange) {\n            return;\n        }\n\n        if (editing) {\n            const body = doc?.getSelfOrHeaderFooterModel(editing.segmentId)?.getBody();\n            const matchedRange = body?.customRanges?.find((i) => editing?.linkId === i.rangeId && i.startIndex === editing.startIndex && i.endIndex === editing.endIndex);\n            if (doc && matchedRange) {\n                setLink(matchedRange.properties?.url ?? '');\n                setLabel(BuildTextUtils.transform.getPlainText(getBodySlice(body!, matchedRange.startIndex, matchedRange.endIndex + 1).dataStream));\n            }\n            return;\n        }\n\n        const body = doc?.getSelfOrHeaderFooterModel(activeRange.segmentId)?.getBody();\n        const selection = body ? activeRange : null;\n        const matchedRange = selection && BuildTextUtils.customRange.getCustomRangesInterestsWithSelection(selection, body?.customRanges ?? [])?.[0];\n        if (doc && matchedRange) {\n            setLink(matchedRange?.properties?.url ?? '');\n        }\n    }, [doc, editing, docSelectionManagerService, univerInstanceService]);\n\n    const handleCancel = () => {\n        hyperLinkService.hideEditPopup();\n    };\n    const handleConfirm = () => {\n        setShowError(true);\n        if (!isLegal || !doc) {\n            return;\n        }\n        const linkFinal = transformUrl(link);\n\n        if (!editing) {\n            commandService.executeCommand(AddDocHyperLinkCommand.id, {\n                unitId: doc.getUnitId(),\n                payload: linkFinal,\n            });\n        } else {\n            if (!label) {\n                return;\n            }\n\n            commandService.executeCommand(UpdateDocHyperLinkCommand.id, {\n                unitId: doc.getUnitId(),\n                payload: linkFinal,\n                linkId: editing.linkId,\n                label,\n                segmentId: editing.segmentId,\n            });\n        }\n        hyperLinkService.hideEditPopup();\n    };\n\n    if (!doc) {\n        return;\n    }\n\n    return (\n        <div className={styles.docsLinkEdit}>\n            <div>\n                {editing\n                    ? (\n                        <FormLayout\n                            label={localeService.t('docLink.edit.label')}\n                            error={showError && !label ? localeService.t('docLink.edit.labelError') : ''}\n                        >\n                            <Input\n                                value={label}\n                                onChange={setLabel}\n                                autoFocus\n                                onKeyDown={(evt) => {\n                                    if (evt.keyCode === KeyCode.ENTER) {\n                                        handleConfirm();\n                                    }\n                                }}\n                            />\n                        </FormLayout>\n                    )\n                    : null}\n                <FormLayout\n                    label={localeService.t('docLink.edit.address')}\n                    error={showError && !isLegal ? localeService.t('docLink.edit.addressError') : ''}\n                >\n                    <Input\n                        value={link}\n                        onChange={setLink}\n                        autoFocus\n                        onKeyDown={(evt) => {\n                            if (evt.keyCode === KeyCode.ENTER) {\n                                handleConfirm();\n                            }\n                        }}\n                    />\n                </FormLayout>\n            </div>\n            <div className={styles.docsLinkEditButtons}>\n                <Button\n                    className={styles.docsLinkEditButton}\n                    onClick={handleCancel}\n                >\n                    {localeService.t('docLink.edit.cancel')}\n                </Button>\n                <Button\n                    disabled={!link}\n                    className={styles.docsLinkEditButton}\n                    type=\"primary\"\n                    onClick={handleConfirm}\n                >\n                    {localeService.t('docLink.edit.confirm')}\n                </Button>\n            </div>\n        </div>\n    );\n};\n\nDocHyperLinkEdit.componentKey = 'docs-hyper-link-edit';\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { ICommand, ITextRangeParam } from '@univerjs/core';\nimport { CommandType, CustomRangeType, generateRandomId, ICommandService } from '@univerjs/core';\nimport { addCustomRangeBySelectionFactory } from '@univerjs/docs';\n\nexport interface IAddDocHyperLinkCommandParams {\n    payload: string;\n    unitId: string;\n    selections?: ITextRangeParam[];\n}\n\nexport const AddDocHyperLinkCommand: ICommand<IAddDocHyperLinkCommandParams> = {\n    type: CommandType.COMMAND,\n    id: 'docs.command.add-hyper-link',\n    async handler(accessor, params) {\n        if (!params) {\n            return false;\n        }\n\n        const { payload, unitId, selections } = params;\n        const commandService = accessor.get(ICommandService);\n        const id = generateRandomId();\n        const doMutation = addCustomRangeBySelectionFactory(\n            accessor,\n            {\n                rangeId: id,\n                rangeType: CustomRangeType.HYPERLINK,\n                properties: {\n                    url: payload,\n                },\n                unitId,\n                selections,\n            }\n        );\n\n        if (doMutation) {\n            return commandService.syncExecuteCommand(doMutation.id, doMutation.params);\n        }\n\n        return false;\n    },\n};\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { DocumentDataModel, ICommand } from '@univerjs/core';\nimport { CommandType, CustomRangeType, getBodySlice, ICommandService, IUniverInstanceService, UniverInstanceType } from '@univerjs/core';\nimport { DocSelectionManagerService, replaceSelectionFactory } from '@univerjs/docs';\n\nexport interface IUpdateDocHyperLinkCommandParams {\n    unitId: string;\n    linkId: string;\n    payload: string;\n    label: string;\n    segmentId: string;\n}\n\nexport const UpdateDocHyperLinkCommand: ICommand<IUpdateDocHyperLinkCommandParams> = {\n    id: 'docs.command.update-hyper-link',\n    type: CommandType.COMMAND,\n    handler(accessor, params) {\n        if (!params) {\n            return false;\n        }\n        const { unitId, payload, segmentId, linkId } = params;\n        const commandService = accessor.get(ICommandService);\n        const univerInstanceService = accessor.get(IUniverInstanceService);\n        const docSelectionManagerService = accessor.get(DocSelectionManagerService);\n        const currentSelection = docSelectionManagerService.getActiveTextRange();\n        const doc = univerInstanceService.getUnit<DocumentDataModel>(unitId, UniverInstanceType.UNIVER_DOC);\n        if (!currentSelection || !doc) {\n            return false;\n        }\n\n        const oldBody = getBodySlice(doc.getSelfOrHeaderFooterModel(segmentId).getBody()!, currentSelection.startOffset!, currentSelection.endOffset!);\n        const textRun = oldBody.textRuns?.[0];\n        if (textRun) {\n            textRun.ed = params.label.length + 1;\n        }\n\n        const replaceSelection = replaceSelectionFactory(accessor, {\n            unitId,\n            body: {\n                dataStream: `${params.label}`,\n                customRanges: [{\n                    rangeId: linkId,\n                    rangeType: CustomRangeType.HYPERLINK,\n                    startIndex: 0,\n                    endIndex: params.label.length + 1,\n                    properties: {\n                        url: payload,\n                    },\n                }],\n                textRuns: textRun ? [textRun] : undefined,\n            },\n            selection: {\n                startOffset: currentSelection.startOffset!,\n                endOffset: currentSelection.endOffset!,\n                collapsed: false,\n                segmentId,\n            },\n        });\n\n        if (!replaceSelection) {\n            return false;\n        }\n\n        return commandService.syncExecuteCommand(replaceSelection.id, replaceSelection.params);\n    },\n};\n", "export default {\n  \"docsLinkEdit\": \"univer-docs-link-edit\",\n  \"docsLinkEditTitle\": \"univer-docs-link-edit-title\",\n  \"docsLinkEditClose\": \"univer-docs-link-edit-close\",\n  \"docsLinkEditButtons\": \"univer-docs-link-edit-buttons\",\n  \"docsLinkEditButton\": \"univer-docs-link-edit-button\"\n};import \"ni:sha-256;7MCnoXya8SkHqDP2TwyN-ySsA7ZGFdsDFZbc83nEby0\";", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { ICommand } from '@univerjs/core';\nimport { CommandType, ICommandService } from '@univerjs/core';\nimport { deleteCustomRangeFactory } from '@univerjs/docs';\n\nexport interface IDeleteDocHyperLinkMutationParams {\n    unitId: string;\n    linkId: string;\n    segmentId?: string;\n}\n\nexport const DeleteDocHyperLinkCommand: ICommand<IDeleteDocHyperLinkMutationParams> = {\n    type: CommandType.COMMAND,\n    id: 'docs.command.delete-hyper-link',\n    async handler(accessor, params) {\n        if (!params) {\n            return false;\n        }\n        const { unitId, linkId, segmentId } = params;\n        const commandService = accessor.get(ICommandService);\n\n        const doMutation = deleteCustomRangeFactory(accessor, { unitId, rangeId: linkId, segmentId });\n        if (!doMutation) {\n            return false;\n        }\n\n        return await commandService.syncExecuteCommand(doMutation.id, doMutation.params);\n    },\n};\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { DocumentDataModel, IAccessor, ICommand } from '@univerjs/core';\nimport { CommandType, CustomRangeType, IUniverInstanceService, UniverInstanceType } from '@univerjs/core';\nimport { DocSelectionManagerService } from '@univerjs/docs';\nimport { DocHyperLinkPopupService } from '../../services/hyper-link-popup.service';\n\nexport const shouldDisableAddLink = (accessor: IAccessor) => {\n    const textSelectionService = accessor.get(DocSelectionManagerService);\n    const univerInstanceService = accessor.get(IUniverInstanceService);\n    const textRanges = textSelectionService.getTextRanges();\n    if (!textRanges?.length) {\n        return true;\n    }\n\n    const activeRange = textRanges[0];\n    const doc = univerInstanceService.getCurrentUnitForType<DocumentDataModel>(UniverInstanceType.UNIVER_DOC);\n    if (!doc || !activeRange || activeRange.collapsed) {\n        return true;\n    }\n\n    return false;\n};\n\nexport interface IShowDocHyperLinkEditPopupOperationParams {\n    link?: {\n        unitId: string;\n        linkId: string;\n        segmentId?: string;\n        segmentPage?: number;\n        startIndex: number;\n        endIndex: number;\n    };\n}\n\nexport const ShowDocHyperLinkEditPopupOperation: ICommand<IShowDocHyperLinkEditPopupOperationParams> = {\n    type: CommandType.OPERATION,\n    id: 'doc.operation.show-hyper-link-edit-popup',\n    handler(accessor, params) {\n        const linkInfo = params?.link;\n        const univerInstanceService = accessor.get(IUniverInstanceService);\n        if (shouldDisableAddLink(accessor) && !linkInfo) {\n            return false;\n        }\n        const hyperLinkService = accessor.get(DocHyperLinkPopupService);\n        const unitId = linkInfo?.unitId || univerInstanceService.getCurrentUnitForType(UniverInstanceType.UNIVER_DOC)?.getUnitId();\n\n        if (!unitId) {\n            return false;\n        }\n        hyperLinkService.showEditPopup(unitId, linkInfo);\n        return true;\n    },\n};\n\nexport interface IShowDocHyperLinkInfoPopupOperationParams {\n    linkId: string;\n    segmentId?: string;\n    unitId: string;\n    segmentPage?: number;\n    startIndex: number;\n    endIndex: number;\n}\n\nexport const ToggleDocHyperLinkInfoPopupOperation: ICommand<IShowDocHyperLinkInfoPopupOperationParams> = {\n    type: CommandType.OPERATION,\n    id: 'doc.operation.toggle-hyper-link-info-popup',\n    handler(accessor, params) {\n        const hyperLinkService = accessor.get(DocHyperLinkPopupService);\n        if (!params) {\n            hyperLinkService.hideInfoPopup();\n            return true;\n        }\n\n        hyperLinkService.showInfoPopup(params);\n        return true;\n    },\n};\n\nexport const ClickDocHyperLinkOperation: ICommand<{ unitId: string; linkId: string; segmentId?: string }> = {\n    type: CommandType.OPERATION,\n    id: 'doc.operation.click-hyper-link',\n    handler(accessor, params) {\n        if (!params) {\n            return false;\n        }\n        const { unitId, linkId, segmentId } = params;\n        const univerInstanceService = accessor.get(IUniverInstanceService);\n        const doc = univerInstanceService.getUnit<DocumentDataModel>(unitId, UniverInstanceType.UNIVER_DOC);\n        const body = doc?.getSelfOrHeaderFooterModel(segmentId).getBody();\n        const link = body?.customRanges?.find((range) => range.rangeId === linkId && range.rangeType === CustomRangeType.HYPERLINK)?.properties?.url;\n\n        if (link) {\n            window.open(link, '_blank', 'noopener noreferrer');\n        }\n        return true;\n    },\n};\n", "export default {\n  \"docLink\": \"univer-doc-link\",\n  \"docLinkType\": \"univer-doc-link-type\",\n  \"docLinkContent\": \"univer-doc-link-content\",\n  \"docLinkContentError\": \"univer-doc-link-content-error\",\n  \"docLinkUrl\": \"univer-doc-link-url\",\n  \"docLinkOperations\": \"univer-doc-link-operations\",\n  \"docLinkOperation\": \"univer-doc-link-operation\",\n  \"docLinkOperationError\": \"univer-doc-link-operation-error\"\n};import \"ni:sha-256;ArbP9Nnw5PMqoyVzx0vsuGkRA9IjYVDogtlQJ3W9Xzc\";", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { DocumentDataModel } from '@univerjs/core';\nimport { CustomRangeType, ICommandService, IUniverInstanceService, LocaleService, UniverInstanceType } from '@univerjs/core';\nimport { clsx, MessageType, Tooltip } from '@univerjs/design';\nimport { CopySingle, LinkSingle, UnlinkSingle, WriteSingle } from '@univerjs/icons';\nimport { IMessageService, useDependency, useObservable } from '@univerjs/ui';\nimport { DeleteDocHyperLinkCommand } from '../../commands/commands/delete-link.command';\nimport { ShowDocHyperLinkEditPopupOperation } from '../../commands/operations/popup.operation';\nimport { DocHyperLinkPopupService } from '../../services/hyper-link-popup.service';\nimport styles from './index.module.less';\n\nexport const DocLinkPopup = () => {\n    const hyperLinkService = useDependency(DocHyperLinkPopupService);\n    const commandService = useDependency(ICommandService);\n    const messageService = useDependency(IMessageService);\n    const localeService = useDependency(LocaleService);\n    const currentPopup = useObservable(hyperLinkService.showingLink$);\n    const univerInstanceService = useDependency(IUniverInstanceService);\n    if (!currentPopup) {\n        return null;\n    }\n\n    const { unitId, linkId, segmentId, startIndex, endIndex } = currentPopup;\n    const doc = univerInstanceService.getUnit<DocumentDataModel>(unitId, UniverInstanceType.UNIVER_DOC);\n    const body = doc?.getSelfOrHeaderFooterModel(segmentId).getBody();\n    const link = body?.customRanges?.find((range) => range.rangeId === linkId && range.rangeType === CustomRangeType.HYPERLINK && range.startIndex === startIndex && range.endIndex === endIndex);\n\n    if (!link) {\n        return null;\n    }\n\n    const url = link.properties?.url;\n\n    return (\n        <div\n            className={styles.docLink}\n            onClick={() => {\n                hyperLinkService.hideInfoPopup();\n            }}\n        >\n            <div className={clsx(styles.docLinkContent)} onClick={() => window.open(url)}>\n                <div className={styles.docLinkType}>\n                    <LinkSingle />\n                </div>\n                <Tooltip showIfEllipsis title={url}>\n                    <span className={styles.docLinkUrl}>{url}</span>\n                </Tooltip>\n            </div>\n            <div className={styles.docLinkOperations}>\n                <div\n                    className={clsx(styles.docLinkOperation)}\n                    onClick={() => {\n                        navigator.clipboard.writeText(url);\n                        messageService.show({\n                            content: localeService.t('docLink.info.coped'),\n                            type: MessageType.Info,\n                        });\n                    }}\n                >\n                    <Tooltip placement=\"bottom\" title={localeService.t('docLink.info.copy')}>\n                        <CopySingle />\n                    </Tooltip>\n\n                </div>\n                <div\n                    className={styles.docLinkOperation}\n                    onClick={() => {\n                        commandService.executeCommand(ShowDocHyperLinkEditPopupOperation.id, {\n                            link: currentPopup,\n                        });\n                    }}\n                >\n                    <Tooltip placement=\"bottom\" title={localeService.t('docLink.info.edit')}>\n                        <WriteSingle />\n                    </Tooltip>\n                </div>\n                <div\n                    className={styles.docLinkOperation}\n                    onClick={() => {\n                        commandService.executeCommand(DeleteDocHyperLinkCommand.id, {\n                            unitId,\n                            linkId: link.rangeId,\n                            segmentId,\n                        });\n                    }}\n                >\n                    <Tooltip placement=\"bottom\" title={localeService.t('docLink.info.cancel')}>\n                        <UnlinkSingle />\n                    </Tooltip>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nDocLinkPopup.componentKey = 'univer.doc.link-info-popup';\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { DocumentDataModel, IDisposable, Nullable } from '@univerjs/core';\nimport { Disposable, Inject, IUniverInstanceService, UniverInstanceType } from '@univerjs/core';\nimport { DocSelectionManagerService } from '@univerjs/docs';\nimport { DocCanvasPopManagerService } from '@univerjs/docs-ui';\nimport { BehaviorSubject } from 'rxjs';\nimport { DocHyperLinkEdit } from '../views/hyper-link-edit';\nimport { DocLinkPopup } from '../views/hyper-link-popup';\n\nexport interface ILinkInfo {\n    unitId: string;\n    linkId: string;\n    segmentId?: string;\n    segmentPage?: number;\n    startIndex: number;\n    endIndex: number;\n}\n\nexport class DocHyperLinkPopupService extends Disposable {\n    private readonly _editingLink$ = new BehaviorSubject<Nullable<ILinkInfo>>(null);\n    private readonly _showingLink$ = new BehaviorSubject<Nullable<ILinkInfo>>(null);\n    readonly editingLink$ = this._editingLink$.asObservable();\n    readonly showingLink$ = this._showingLink$.asObservable();\n\n    private _editPopup: Nullable<IDisposable> = null;\n    private _infoPopup: Nullable<IDisposable> = null;\n\n    constructor(\n        @Inject(DocCanvasPopManagerService) private readonly _docCanvasPopupManagerService: DocCanvasPopManagerService,\n        @Inject(DocSelectionManagerService) private readonly _textSelectionManagerService: DocSelectionManagerService,\n        @IUniverInstanceService private readonly _univerInstanceService: IUniverInstanceService\n    ) {\n        super();\n\n        this.disposeWithMe(() => {\n            this._editingLink$.complete();\n            this._showingLink$.complete();\n        });\n    }\n\n    get editing() {\n        return this._editingLink$.value;\n    }\n\n    get showing() {\n        return this._showingLink$.value;\n    }\n\n    showEditPopup(unitId: string, linkInfo: Nullable<ILinkInfo>): Nullable<IDisposable> {\n        if (this._editPopup) {\n            this._editPopup.dispose();\n        }\n        this._editingLink$.next(linkInfo);\n        const textRanges = this._textSelectionManagerService.getTextRanges({ unitId, subUnitId: unitId });\n        let activeRange = textRanges?.[textRanges.length - 1];\n\n        if (linkInfo) {\n            const { segmentId, segmentPage, startIndex, endIndex } = linkInfo;\n            activeRange = {\n                collapsed: false,\n                startOffset: startIndex,\n                endOffset: endIndex + 1,\n                segmentId,\n                segmentPage,\n            };\n\n            this._textSelectionManagerService.replaceDocRanges([{\n                startOffset: startIndex,\n                endOffset: endIndex + 1,\n            }]);\n        }\n\n        if (activeRange) {\n            this._editPopup = this._docCanvasPopupManagerService.attachPopupToRange(\n                activeRange,\n                {\n                    componentKey: DocHyperLinkEdit.componentKey,\n                    direction: 'bottom',\n                },\n                unitId\n            );\n            return this._editPopup;\n        }\n\n        return null;\n    }\n\n    hideEditPopup() {\n        this._editingLink$.next(null);\n        this._editPopup?.dispose();\n    }\n\n    showInfoPopup(info: ILinkInfo): Nullable<IDisposable> {\n        const { linkId, unitId, segmentId, segmentPage, startIndex, endIndex } = info;\n        if (\n            this.showing?.linkId === linkId &&\n            this.showing?.unitId === unitId &&\n            this.showing?.segmentId === segmentId &&\n            this.showing?.segmentPage === segmentPage &&\n            this.showing?.startIndex === startIndex &&\n            this.showing?.endIndex === endIndex\n        ) {\n            return;\n        }\n\n        if (this._infoPopup) {\n            this._infoPopup.dispose();\n        }\n        const doc = this._univerInstanceService.getUnit<DocumentDataModel>(unitId, UniverInstanceType.UNIVER_DOC);\n        if (!doc) {\n            return;\n        }\n        this._showingLink$.next({ unitId, linkId, segmentId, segmentPage, startIndex, endIndex });\n\n        this._infoPopup = this._docCanvasPopupManagerService.attachPopupToRange(\n            {\n                collapsed: false,\n                startOffset: startIndex,\n                endOffset: endIndex + 1,\n                segmentId,\n                segmentPage,\n            },\n            {\n                componentKey: DocLinkPopup.componentKey,\n                direction: 'top-center',\n                multipleDirection: 'top',\n                onClickOutside: () => {\n                    this.hideInfoPopup();\n                },\n            },\n            unitId\n        );\n        return this._infoPopup;\n    }\n\n    hideInfoPopup() {\n        this._showingLink$.next(null);\n        this._infoPopup?.dispose();\n    }\n}\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { DocumentDataModel } from '@univerjs/core';\nimport type { ISetTextSelectionsOperationParams } from '@univerjs/docs';\nimport { Disposable, ICommandService, Inject, IUniverInstanceService, UniverInstanceType } from '@univerjs/core';\nimport { SetTextSelectionsOperation } from '@univerjs/docs';\nimport { DocHyperLinkPopupService } from '../services/hyper-link-popup.service';\n\nexport class DocHyperLinkSelectionController extends Disposable {\n    constructor(\n        @ICommandService private readonly _commandService: ICommandService,\n        @IUniverInstanceService private readonly _univerInstanceService: IUniverInstanceService,\n        @Inject(DocHyperLinkPopupService) private readonly _docHyperLinkService: DocHyperLinkPopupService\n    ) {\n        super();\n\n        this._initSelectionChange();\n    }\n\n    private _initSelectionChange() {\n        this.disposeWithMe(\n            this._commandService.onCommandExecuted((commandInfo) => {\n                if (commandInfo.id === SetTextSelectionsOperation.id) {\n                    const params = commandInfo.params as ISetTextSelectionsOperationParams;\n                    const { unitId, ranges, segmentId } = params;\n\n                    const doc = this._univerInstanceService.getUnit<DocumentDataModel>(unitId, UniverInstanceType.UNIVER_DOC);\n                    const primary = ranges[0];\n                    if (primary && doc) {\n                        const { startOffset, endOffset, collapsed, segmentPage } = primary;\n                        const customRanges = doc.getSelfOrHeaderFooterModel(segmentId)?.getBody()?.customRanges;\n                        if (collapsed) {\n                            // cursor\n                            const index = customRanges?.findIndex((value) => (value.startIndex) < startOffset && value.endIndex > endOffset - 1) ?? -1;\n                            if (index > -1) {\n                                const customRange = customRanges![index];\n                                this._docHyperLinkService.showInfoPopup({ unitId, linkId: customRange.rangeId, segmentId, segmentPage, startIndex: customRange.startIndex, endIndex: customRange.endIndex });\n                                return;\n                            }\n                        } else {\n                            // range\n                            const range = customRanges?.find((value) => value.startIndex <= startOffset && value.endIndex >= (endOffset - 1));\n                            if (range) {\n                                return;\n                            }\n                        }\n                    }\n\n                    this._docHyperLinkService.hideInfoPopup();\n                    this._docHyperLinkService.hideEditPopup();\n                }\n            })\n        );\n    }\n}\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { DocumentDataModel } from '@univerjs/core';\nimport type { IRenderContext, IRenderModule } from '@univerjs/engine-render';\nimport { CustomRangeType, Disposable, DOCS_NORMAL_EDITOR_UNIT_ID_KEY, DOCS_ZEN_EDITOR_UNIT_ID_KEY, ICommandService, Inject } from '@univerjs/core';\nimport { DocSelectionManagerService, DocSkeletonManagerService } from '@univerjs/docs';\nimport { DocEventManagerService } from '@univerjs/docs-ui';\nimport { ClickDocHyperLinkOperation, ToggleDocHyperLinkInfoPopupOperation } from '../../commands/operations/popup.operation';\nimport { DocHyperLinkPopupService } from '../../services/hyper-link-popup.service';\n\nexport class DocHyperLinkEventRenderController extends Disposable implements IRenderModule {\n    get _skeleton() {\n        return this._docSkeletonManagerService.getSkeleton();\n    }\n\n    constructor(\n        private readonly _context: IRenderContext<DocumentDataModel>,\n        @Inject(DocEventManagerService) private readonly _docEventManagerService: DocEventManagerService,\n        @ICommandService private readonly _commandService: ICommandService,\n        @Inject(DocHyperLinkPopupService) private readonly _hyperLinkPopupService: DocHyperLinkPopupService,\n        @Inject(DocSkeletonManagerService) private readonly _docSkeletonManagerService: DocSkeletonManagerService,\n        @Inject(DocSelectionManagerService) private readonly _docSelectionManagerService: DocSelectionManagerService\n    ) {\n        super();\n\n        if (this._context.unitId === DOCS_ZEN_EDITOR_UNIT_ID_KEY || this._context.unitId === DOCS_NORMAL_EDITOR_UNIT_ID_KEY) {\n            return;\n        }\n\n        this._initHover();\n        this._initClick();\n    }\n\n    private _hideInfoPopup() {\n        if (this._hyperLinkPopupService.showing) {\n            this._commandService.executeCommand(\n                ToggleDocHyperLinkInfoPopupOperation.id\n            );\n        }\n    }\n\n    private _initHover() {\n        this.disposeWithMe(\n            this._docEventManagerService.hoverCustomRanges$.subscribe((ranges) => {\n                const link = ranges.find((range) => range.range.rangeType === CustomRangeType.HYPERLINK);\n                const activeRanges = this._docSelectionManagerService.getTextRanges();\n                const currentSegmentId = activeRanges?.[0].segmentId;\n                if ((link?.segmentId ?? '') !== currentSegmentId) {\n                    this._hideInfoPopup();\n                    return;\n                }\n\n                if (link) {\n                    this._commandService.executeCommand(\n                        ToggleDocHyperLinkInfoPopupOperation.id,\n                        {\n                            unitId: this._context.unitId,\n                            linkId: link.range.rangeId,\n                            segmentId: link.segmentId,\n                            segmentPage: link.segmentPageIndex,\n                            rangeId: link.range.rangeId,\n                            startIndex: link.range.startIndex,\n                            endIndex: link.range.endIndex,\n                        }\n                    );\n                } else {\n                    this._hideInfoPopup();\n                }\n            })\n        );\n    }\n\n    private _initClick() {\n        this.disposeWithMe(\n            this._docEventManagerService.clickCustomRanges$.subscribe((range) => {\n                const link = range.range;\n                if (link) {\n                    this._commandService.executeCommand(\n                        ClickDocHyperLinkOperation.id,\n                        {\n                            unitId: this._context.unitId,\n                            linkId: link.rangeId,\n                            segmentId: range.segmentId,\n                        }\n                    );\n                }\n            })\n        );\n    }\n}\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { DocumentDataModel } from '@univerjs/core';\nimport type { IRenderContext, IRenderModule } from '@univerjs/engine-render';\nimport { Disposable, Inject } from '@univerjs/core';\nimport { DOC_INTERCEPTOR_POINT, DocInterceptorService } from '@univerjs/docs';\nimport { DocRenderController } from '@univerjs/docs-ui';\nimport { distinctUntilChanged, pairwise } from 'rxjs';\nimport { DocHyperLinkPopupService } from '../../services/hyper-link-popup.service';\n\nexport class DocHyperLinkRenderController extends Disposable implements IRenderModule {\n    constructor(\n        private readonly _context: IRenderContext<DocumentDataModel>,\n        @Inject(DocInterceptorService) private readonly _docInterceptorService: DocInterceptorService,\n        @Inject(DocHyperLinkPopupService) private readonly _hyperLinkService: DocHyperLinkPopupService,\n        @Inject(DocRenderController) private readonly _docRenderController: DocRenderController\n    ) {\n        super();\n\n        this._init();\n        this._initReRender();\n    }\n\n    private _init() {\n        this._docInterceptorService.intercept(DOC_INTERCEPTOR_POINT.CUSTOM_RANGE, {\n            handler: (data, pos, next) => {\n                if (!data) {\n                    return next(data);\n                }\n                const { unitId, index } = pos;\n                const activeLink = this._hyperLinkService.showing;\n\n                if (!activeLink) {\n                    return next({\n                        ...data,\n                        active: false,\n                    });\n                }\n                const { linkId, unitId: linkUnitId, startIndex, endIndex } = activeLink;\n                const isActive = linkUnitId === unitId && data.rangeId === linkId && index >= startIndex && index <= endIndex;\n\n                return next({\n                    ...data,\n                    active: isActive,\n                });\n            },\n        });\n    }\n\n    private _initReRender() {\n        this.disposeWithMe(this._hyperLinkService.showingLink$\n            .pipe(\n                distinctUntilChanged((prev, aft) => prev?.linkId === aft?.linkId && prev?.unitId === aft?.unitId && prev?.startIndex === aft?.startIndex),\n                pairwise()\n            )\n            .subscribe(([preLink, link]) => {\n                if (link) {\n                    if (link.unitId === this._context.unitId) {\n                        this._docRenderController.reRender(link.unitId);\n                    }\n                } else {\n                    if (preLink && preLink.unitId === this._context.unitId) {\n                        this._docRenderController.reRender(preLink.unitId);\n                    }\n                }\n            }));\n    }\n}\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { IAccessor } from '@univerjs/core';\nimport type { IMenuButtonItem, IShortcutItem } from '@univerjs/ui';\nimport { UniverInstanceType } from '@univerjs/core';\nimport { DocSelectionManagerService } from '@univerjs/docs';\nimport { whenDocAndEditorFocused } from '@univerjs/docs-ui';\nimport { getMenuHiddenObservable, KeyCode, MenuItemType, MetaKeys } from '@univerjs/ui';\nimport { debounceTime, Observable } from 'rxjs';\nimport { shouldDisableAddLink, ShowDocHyperLinkEditPopupOperation } from '../commands/operations/popup.operation';\n\nexport const DOC_LINK_ICON = 'doc-hyper-link-icon';\n\nexport function AddHyperLinkMenuItemFactory(accessor: IAccessor): IMenuButtonItem {\n    return {\n        id: ShowDocHyperLinkEditPopupOperation.id,\n        type: MenuItemType.BUTTON,\n        icon: DOC_LINK_ICON,\n        title: 'docLink.menu.tooltip',\n        tooltip: 'docLink.menu.tooltip',\n        hidden$: getMenuHiddenObservable(accessor, UniverInstanceType.UNIVER_DOC),\n        disabled$: new Observable(function (subscribe) {\n            const textSelectionService = accessor.get(DocSelectionManagerService);\n            const observer = textSelectionService.textSelection$.pipe(debounceTime(16)).subscribe(() => {\n                subscribe.next(shouldDisableAddLink(accessor));\n            });\n\n            return () => {\n                observer.unsubscribe();\n            };\n        }),\n    };\n}\n\nexport const addLinkShortcut: IShortcutItem = {\n    id: ShowDocHyperLinkEditPopupOperation.id,\n    binding: MetaKeys.CTRL_COMMAND | KeyCode.K,\n    description: 'docLink.menu.tooltip',\n    preconditions: whenDocAndEditorFocused,\n};\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { MenuSchemaType } from '@univerjs/ui';\nimport { ContextMenuGroup, ContextMenuPosition, RibbonStartGroup } from '@univerjs/ui';\nimport { ShowDocHyperLinkEditPopupOperation } from '../commands/operations/popup.operation';\nimport { AddHyperLinkMenuItemFactory } from './menu';\n\nexport const menuSchema: MenuSchemaType = {\n    [RibbonStartGroup.OTHERS]: {\n        [ShowDocHyperLinkEditPopupOperation.id]: {\n            order: 0,\n            menuItemFactory: AddHyperLinkMenuItemFactory,\n        },\n    },\n    [ContextMenuPosition.MAIN_AREA]: {\n        [ContextMenuGroup.DATA]: {\n            [ShowDocHyperLinkEditPopupOperation.id]: {\n                order: 0,\n                menuItemFactory: AddHyperLinkMenuItemFactory,\n            },\n        },\n    },\n};\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { MenuConfig } from '@univerjs/ui';\nimport { Disposable, ICommandService, Inject } from '@univerjs/core';\nimport { LinkSingle } from '@univerjs/icons';\nimport { ComponentManager, IMenuManagerService, IShortcutService } from '@univerjs/ui';\nimport { AddDocHyperLinkCommand } from '../commands/commands/add-link.command';\nimport { DeleteDocHyperLinkCommand } from '../commands/commands/delete-link.command';\nimport { UpdateDocHyperLinkCommand } from '../commands/commands/update-link.command';\nimport { ClickDocHyperLinkOperation, ShowDocHyperLinkEditPopupOperation, ToggleDocHyperLinkInfoPopupOperation } from '../commands/operations/popup.operation';\nimport { DocHyperLinkEdit } from '../views/hyper-link-edit';\nimport { DocLinkPopup } from '../views/hyper-link-popup';\nimport { addLinkShortcut, DOC_LINK_ICON } from './menu';\nimport { menuSchema } from './menu.schema';\n\nexport interface IDocHyperLinkUIConfig {\n    menu: MenuConfig;\n}\n\nexport class DocHyperLinkUIController extends Disposable {\n    constructor(\n        @Inject(ComponentManager) private readonly _componentManager: ComponentManager,\n        @ICommandService private readonly _commandService: ICommandService,\n        @IMenuManagerService private readonly _menuManagerService: IMenuManagerService,\n        @IShortcutService private readonly _shortcutService: IShortcutService\n    ) {\n        super();\n\n        this._initComponents();\n        this._initCommands();\n        this._initMenus();\n        this._initShortcut();\n    }\n\n    private _initComponents() {\n        ([\n            [DocHyperLinkEdit, DocHyperLinkEdit.componentKey],\n            [DocLinkPopup, DocLinkPopup.componentKey],\n            [LinkSingle, DOC_LINK_ICON],\n        ] as const).forEach(([comp, key]) => {\n            this._componentManager.register(key, comp);\n        });\n    }\n\n    private _initCommands() {\n        [\n            AddDocHyperLinkCommand,\n            UpdateDocHyperLinkCommand,\n            DeleteDocHyperLinkCommand,\n            ShowDocHyperLinkEditPopupOperation,\n            ToggleDocHyperLinkInfoPopupOperation,\n            ClickDocHyperLinkOperation,\n        ].forEach((command) => {\n            this._commandService.registerCommand(command);\n        });\n    }\n\n    private _initShortcut() {\n        [addLinkShortcut].forEach((shortcut) => {\n            this._shortcutService.registerShortcut(shortcut);\n        });\n    }\n\n    private _initMenus() {\n        this._menuManagerService.mergeMenu(menuSchema);\n    }\n}\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const DOC_HYPER_LINK_UI_PLUGIN = 'DOC_HYPER_LINK_UI_PLUGIN';\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Dependency } from '@univerjs/core';\nimport type { IUniverDocsHyperLinkUIConfig } from './controllers/config.schema';\nimport { DependentOn, IConfigService, Inject, Injector, merge, Plugin, UniverInstanceType } from '@univerjs/core';\nimport { UniverDocsHyperLinkPlugin } from '@univerjs/docs-hyper-link';\nimport { IRenderManagerService } from '@univerjs/engine-render';\nimport { defaultPluginConfig, DOCS_HYPER_LINK_UI_PLUGIN_CONFIG_KEY } from './controllers/config.schema';\nimport { DocHyperLinkSelectionController } from './controllers/doc-hyper-link-selection.controller';\nimport { DocHyperLinkEventRenderController } from './controllers/render-controllers/hyper-link-event.render-controller';\nimport { DocHyperLinkRenderController } from './controllers/render-controllers/render.controller';\nimport { DocHyperLinkUIController } from './controllers/ui.controller';\nimport { DocHyperLinkPopupService } from './services/hyper-link-popup.service';\nimport { DOC_HYPER_LINK_UI_PLUGIN } from './types/const';\n\n@DependentOn(UniverDocsHyperLinkPlugin)\nexport class UniverDocsHyperLinkUIPlugin extends Plugin {\n    static override pluginName = DOC_HYPER_LINK_UI_PLUGIN;\n    static override type = UniverInstanceType.UNIVER_DOC;\n\n    constructor(\n        private readonly _config: Partial<IUniverDocsHyperLinkUIConfig> = defaultPluginConfig,\n        @Inject(Injector) protected override _injector: Injector,\n        @IRenderManagerService private readonly _renderManagerSrv: IRenderManagerService,\n        @IConfigService private readonly _configService: IConfigService\n    ) {\n        super();\n\n        // Manage the plugin configuration.\n        const { menu, ...rest } = merge(\n            {},\n            defaultPluginConfig,\n            this._config\n        );\n        if (menu) {\n            this._configService.setConfig('menu', menu, { merge: true });\n        }\n        this._configService.setConfig(DOCS_HYPER_LINK_UI_PLUGIN_CONFIG_KEY, rest);\n    }\n\n    override onStarting(): void {\n        const deps: Dependency[] = [\n            [DocHyperLinkPopupService],\n            [DocHyperLinkUIController],\n            [DocHyperLinkSelectionController],\n        ];\n        deps.forEach((dep) => {\n            this._injector.add(dep);\n        });\n\n        this._injector.get(DocHyperLinkUIController);\n    }\n\n    override onReady(): void {\n        this._injector.get(DocHyperLinkSelectionController);\n    }\n\n    override onRendered(): void {\n        this._initRenderModule();\n    }\n\n    private _initRenderModule() {\n        ([\n            [DocHyperLinkRenderController],\n            [DocHyperLinkEventRenderController],\n        ] as Dependency[]).forEach((dep) => {\n            this._renderManagerSrv.registerRenderModule(UniverInstanceType.UNIVER_DOC, dep);\n        });\n    }\n}\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { ICommand } from '@univerjs/core';\nimport type { IInnerCutCommandParams } from '@univerjs/docs-ui';\nimport { CommandType, ICommandService, RANGE_DIRECTION } from '@univerjs/core';\nimport { CutContentCommand } from '@univerjs/docs-ui';\n\ninterface IDeleteSearchKeyCommandParams {\n    start: number;\n    end: number;\n}\n\nexport const DeleteSearchKeyCommand: ICommand<IDeleteSearchKeyCommandParams> = {\n    id: 'doc.command.delete-search-key',\n\n    type: CommandType.COMMAND,\n\n    handler: (accessor, params: IDeleteSearchKeyCommandParams) => {\n        const commandService = accessor.get(ICommandService);\n        const { start, end } = params;\n        return commandService.syncExecuteCommand(CutContentCommand.id, {\n            segmentId: '',\n            textRanges: [{\n                startOffset: start,\n                endOffset: start,\n                collapsed: true,\n            }],\n            selections: [{\n                startOffset: start,\n                endOffset: end,\n                collapsed: false,\n                direction: RANGE_DIRECTION.FORWARD,\n            }],\n        } as IInnerCutCommandParams);\n    },\n};\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { LocaleService } from '@univerjs/core';\nimport { useDependency } from '@univerjs/ui';\n\nexport const KeywordInputPlaceholderComponentKey = 'docs.quick.insert.keyword-input-placeholder';\n\nexport const KeywordInputPlaceholder = () => {\n    const localeService = useDependency(LocaleService);\n    // TODO: \u9700\u8981\u6839\u636EfontSize\u6765\u8BA1\u7B97\u9AD8\u5EA6\u8DDF\u504F\u79FB\n    return <div className=\"univer-translate-y-1.5 univer-text-sm univer-text-gray-500\">{localeService.t('docQuickInsert.keywordInputPlaceholder')}</div>;\n};\n\nKeywordInputPlaceholder.componentKey = KeywordInputPlaceholderComponentKey;\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { DocPopupMenu, IDocPopupMenuItem } from '../services/doc-quick-insert-popup.service';\nimport { CommandType, Direction, DisposableCollection, generateRandomId, ICommandService, LocaleService, toDisposable } from '@univerjs/core';\nimport { clsx, Menu, MenuItem, MenuItemGroup } from '@univerjs/design';\nimport { ComponentManager, IShortcutService, KeyCode, useDependency, useObservable } from '@univerjs/ui';\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport { CloseQuickInsertPopupOperation } from '../commands/operations/quick-insert-popup.operation';\nimport { DocQuickInsertPopupService } from '../services/doc-quick-insert-popup.service';\nimport { QuickInsertPlaceholder } from './QuickInsertPlaceholder';\n\nfunction filterMenusByKeyword(menus: DocPopupMenu[], keyword: string) {\n    return menus\n        .map((menu) => ({ ...menu }))\n        .filter((menu) => {\n            if ('children' in menu) {\n                menu.children = filterMenusByKeyword(menu.children!, keyword) as IDocPopupMenuItem[];\n\n                return menu.children.length > 0;\n            }\n\n            const keywords = (menu as IDocPopupMenuItem).keywords;\n\n            if (keywords) {\n                return keywords.some((word) => word.includes(keyword));\n            }\n\n            return menu.title.toLowerCase().includes(keyword);\n        });\n}\n\nfunction translateMenus(menus: DocPopupMenu[], localeService: LocaleService) {\n    return menus.map((_menu) => {\n        const menu = { ..._menu } as DocPopupMenu;\n        if ('children' in menu) {\n            menu.children = translateMenus(menu.children!, localeService) as IDocPopupMenuItem[];\n        }\n\n        menu.title = localeService.t(menu.title);\n\n        if ('keywords' in menu) {\n            menu.keywords = menu.keywords!\n                .concat(menu.title)\n                .map((word) => word.toLowerCase());\n        }\n\n        return menu;\n    });\n}\n\nconst interceptKeys = [KeyCode.ARROW_UP, KeyCode.ARROW_DOWN, KeyCode.ENTER];\n\nexport const QuickInsertPopup = () => {\n    const localeService = useDependency(LocaleService);\n    const docQuickInsertPopupService = useDependency(DocQuickInsertPopupService);\n    const componentManager = useDependency(ComponentManager);\n    const shortcutService = useDependency(IShortcutService);\n    const commandService = useDependency(ICommandService);\n\n    const id = useMemo(() => generateRandomId(), []);\n\n    const [focusedMenuIndex, setFocusedMenuIndex] = useState(0);\n    const focusedMenuRef = useRef<IDocPopupMenuItem | null>(null);\n\n    const menuIndexAccumulator = useRef(0);\n    menuIndexAccumulator.current = 0;\n\n    const filterKeyword = useObservable(docQuickInsertPopupService.filterKeyword$, '');\n    const currentPopup = useObservable(docQuickInsertPopupService.editPopup$);\n    const menus = useObservable<DocPopupMenu[]>(currentPopup?.popup.menus$, []);\n\n    const translatedMenus = useMemo(() => {\n        return translateMenus(menus, localeService);\n    }, [menus]);\n\n    const [filteredMenus, setFilteredMenus] = useState<DocPopupMenu[]>(() => {\n        return filterMenusByKeyword(translatedMenus, filterKeyword.toLowerCase());\n    });\n\n    useEffect(() => {\n        const id = requestIdleCallback(() => {\n            setFilteredMenus(filterMenusByKeyword(translatedMenus, filterKeyword.toLowerCase()));\n        });\n\n        return () => {\n            cancelIdleCallback(id);\n        };\n    }, [translatedMenus, filterKeyword]);\n\n    const handleMenuSelect = (menu: IDocPopupMenuItem) => {\n        docQuickInsertPopupService.emitMenuSelected(menu);\n        commandService.executeCommand(CloseQuickInsertPopupOperation.id);\n    };\n\n    useEffect(() => {\n        /** Use up or down to navigate the focused menu instead of moving the cursor in documents. */\n        const disposableCollection = new DisposableCollection();\n\n        const shortcutItems = shortcutService.getAllShortcuts();\n\n        const interceptedShortcutItems = shortcutItems.filter((item) => item.binding && interceptKeys.includes(item.binding));\n        // disable the shortcut items of moving the cursor in documents\n        interceptedShortcutItems.forEach((item) => {\n            const rawPreconditions = item.preconditions;\n\n            item.preconditions = () => false;\n\n            disposableCollection.add(toDisposable(() => {\n                item.preconditions = rawPreconditions;\n            }));\n        });\n\n        const enterCommand = {\n            id: `quick.insert.popup.enter.${id}`,\n            type: CommandType.OPERATION,\n            handler: () => {\n                const menu = focusedMenuRef.current;\n                if (menu) {\n                    handleMenuSelect(menu);\n                }\n            },\n        };\n\n        const moveCursorUpCommand = {\n            id: `quick.insert.popup.move.cursor.up.${id}`,\n            type: CommandType.OPERATION,\n            handler: () => {\n                setFocusedMenuIndex((index) => {\n                    const nextIndex = (index - 1);\n\n                    return nextIndex >= 0 ? nextIndex : menuIndexAccumulator.current - 1;\n                });\n            },\n        };\n        const moveCursorDownCommand = {\n            id: `quick.insert.popup.move.cursor.down.${id}`,\n            type: CommandType.OPERATION,\n            handler: () => {\n                setFocusedMenuIndex((index) => {\n                    const nextIndex = (index + 1);\n\n                    return nextIndex <= (menuIndexAccumulator.current - 1) ? nextIndex : 0;\n                });\n            },\n        };\n\n        // register the commands of moving the focused menu up and down\n        disposableCollection.add(commandService.registerCommand(moveCursorUpCommand));\n        disposableCollection.add(commandService.registerCommand(moveCursorDownCommand));\n        disposableCollection.add(commandService.registerCommand(enterCommand));\n        disposableCollection.add(shortcutService.registerShortcut({\n            priority: 1000,\n            id: moveCursorUpCommand.id,\n            binding: KeyCode.ARROW_UP,\n            preconditions: () => true,\n            staticParameters: {\n                direction: Direction.UP,\n            },\n        }));\n\n        disposableCollection.add(shortcutService.registerShortcut({\n            priority: 1000,\n            id: moveCursorDownCommand.id,\n            binding: KeyCode.ARROW_DOWN,\n            preconditions: () => true,\n            staticParameters: {\n                direction: Direction.DOWN,\n            },\n        }));\n\n        disposableCollection.add(shortcutService.registerShortcut({\n            priority: 1000,\n            id: enterCommand.id,\n            binding: KeyCode.ENTER,\n            preconditions: () => true,\n        }));\n\n        return () => {\n            disposableCollection.dispose();\n        };\n    }, []);\n\n    useEffect(() => {\n        setFocusedMenuIndex(0);\n    }, [filteredMenus]);\n\n    function renderMenus(menus: DocPopupMenu[]) {\n        return menus.map((menu) => {\n            const iconKey = (menu as IDocPopupMenuItem).icon;\n            const Icon = iconKey ? componentManager.get(iconKey) : null;\n\n            if ('children' in menu) {\n                return (\n                    <MenuItemGroup\n                        key={menu.id}\n                        title={(\n                            <div\n                                className={`\n                                  univer-mb-2 univer-flex univer-items-center univer-text-xs univer-text-gray-400\n                                `}\n                            >\n                                {Icon && <span className=\"univer-mr-2 univer-inline-flex univer-text-base\"><Icon /></span>}\n                                <span>{menu.title}</span>\n                            </div>\n                        )}\n                    >\n                        {renderMenus(menu.children!)}\n                    </MenuItemGroup>\n                );\n            }\n\n            const currentMenuIndex = menuIndexAccumulator.current;\n            const isFocused = focusedMenuIndex === currentMenuIndex;\n            if (isFocused) {\n                focusedMenuRef.current = menu as IDocPopupMenuItem;\n            }\n\n            menuIndexAccumulator.current++;\n\n            return (\n                <MenuItem\n                    onMouseEnter={() => setFocusedMenuIndex(currentMenuIndex)}\n                    onMouseLeave={() => setFocusedMenuIndex(Number.NaN)}\n                    key={menu.id}\n                    className={clsx('univer-text-sm', {\n                        'hover:univer-bg-transparent': !isFocused,\n                        'univer-bg-gray-100': isFocused,\n                    })}\n                    onClick={() => {\n                        handleMenuSelect(menu as IDocPopupMenuItem);\n                    }}\n                >\n                    <div className=\"univer-flex univer-items-center univer-px-1\">\n                        {Icon && <span className=\"univer-mr-2 univer-inline-flex univer-text-base\"><Icon /></span>}\n                        <span>{menu.title}</span>\n                    </div>\n                </MenuItem>\n            );\n        });\n    }\n\n    const hasMenus = filteredMenus.length > 0;\n\n    const Placeholder = currentPopup?.popup.Placeholder || componentManager.get(QuickInsertPlaceholder.componentKey);\n\n    return (\n        <div\n            className={clsx(`\n              univer-rounded-lg univer-border univer-border-solid univer-border-gray-100\n              univer-shadow-[0_0_10px_0_rgba(0,0,0,0.1)]\n            `)}\n        >\n            {hasMenus\n                ? (\n                    <div className=\"univer-max-h-[360px] univer-w-[220px] univer-overflow-y-auto\">\n                        <Menu>\n                            {renderMenus(filteredMenus)}\n                        </Menu>\n                    </div>\n                )\n                : Placeholder && <Placeholder />}\n        </div>\n\n    );\n};\n\nQuickInsertPopup.componentKey = 'docs.quick.insert.popup';\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { LocaleService } from '@univerjs/core';\nimport { useDependency } from '@univerjs/ui';\n\nexport const QuickInsertPlaceholderComponentKey = 'docs.quick.insert.placeholder';\n\nexport const QuickInsertPlaceholder = () => {\n    const localeService = useDependency(LocaleService);\n    return (\n        <div\n            className={`\n              univer-flex univer-h-full univer-items-center univer-justify-center univer-rounded-lg univer-bg-white\n              univer-px-12 univer-py-6 univer-text-gray-400\n            `}\n        >\n            <span>{localeService.t('docQuickInsert.placeholder')}</span>\n        </div>\n    );\n};\n\nQuickInsertPlaceholder.componentKey = QuickInsertPlaceholderComponentKey;\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { DocumentDataModel, IDisposable, Nullable } from '@univerjs/core';\nimport type { IInsertCommandParams } from '@univerjs/docs-ui';\nimport type { Observable } from 'rxjs';\nimport { Disposable, ICommandService, Inject, IUniverInstanceService, UniverInstanceType } from '@univerjs/core';\nimport { DocCanvasPopManagerService } from '@univerjs/docs-ui';\nimport { BehaviorSubject, combineLatest, distinctUntilChanged, map, tap } from 'rxjs';\nimport { DeleteSearchKeyCommand } from '../commands/commands/doc-quick-insert.command';\nimport { KeywordInputPlaceholder } from '../views/KeywordInputPlaceholder';\nimport { QuickInsertPopup } from '../views/QuickInsertPopup';\n\nexport interface IDocPopupGroupItem {\n    id: string;\n    icon?: string;\n    title: string;\n    children?: IDocPopupMenuItem[];\n}\n\nexport interface IDocPopupMenuItem {\n    id: string;\n    icon?: string;\n    title: string;\n    keywords?: string[];\n}\n\nexport type DocPopupMenu = IDocPopupGroupItem | IDocPopupMenuItem;\n\nexport interface IDocPopup {\n    keyword: string;\n    menus$: Observable<DocPopupMenu[]>;\n    Placeholder?: React.ComponentType;\n    preconditions?: (params: IInsertCommandParams) => boolean;\n}\n\nexport class DocQuickInsertPopupService extends Disposable {\n    private readonly _popups: Set<IDocPopup> = new Set();\n\n    private readonly _editPopup$ = new BehaviorSubject<Nullable<{\n        popup: IDocPopup;\n        anchor: number;\n        disposable: IDisposable;\n        unitId: string;\n    }>>(undefined);\n\n    readonly editPopup$ = this._editPopup$.asObservable();\n    get editPopup() {\n        return this._editPopup$.value;\n    }\n\n    private readonly _inputOffset$ = new BehaviorSubject<{ start: number; end: number }>({ start: 0, end: 0 });\n    readonly inputOffset$ = this._inputOffset$.asObservable();\n    get inputOffset() {\n        return this._inputOffset$.value;\n    }\n\n    setInputOffset(offset: { start: number; end: number }) {\n        this._inputOffset$.next(offset);\n    }\n\n    readonly filterKeyword$: Observable<string>;\n\n    private _menuSelectedCallbacks: Set<(menu: IDocPopupMenuItem) => void> = new Set();\n\n    private _inputPlaceholderRenderRoot: {\n        unmount?: IDisposable;\n        mount: () => void;\n    } | null = null;\n\n    constructor(\n        @Inject(DocCanvasPopManagerService) private readonly _docCanvasPopupManagerService: DocCanvasPopManagerService,\n        @Inject(IUniverInstanceService) private readonly _univerInstanceService: IUniverInstanceService,\n        @Inject(ICommandService) private readonly _commandService: ICommandService\n    ) {\n        super();\n\n        this.disposeWithMe(this._editPopup$);\n\n        const getBodySlice = (start: number, end: number) => this._univerInstanceService.getCurrentUnitOfType<DocumentDataModel>(UniverInstanceType.UNIVER_DOC)?.getBody()?.dataStream.slice(start, end);\n\n        this.filterKeyword$ = this._inputOffset$.pipe(\n            map((offset) => {\n                const slice = getBodySlice(offset.start, offset.end);\n\n                return slice?.slice(1) ?? '';\n            }),\n            distinctUntilChanged()\n        );\n\n        this.disposeWithMe(combineLatest([\n            this.filterKeyword$.pipe(tap((filterKeyword) => {\n                if (filterKeyword.length > 0) {\n                    this._inputPlaceholderRenderRoot?.unmount?.dispose();\n                } else {\n                    this._inputPlaceholderRenderRoot?.mount();\n                }\n            })),\n            this.editPopup$.pipe(tap((popup) => {\n                if (!popup) {\n                    this._inputPlaceholderRenderRoot?.unmount?.dispose();\n                }\n            })),\n        ]).subscribe());\n    }\n\n    resolvePopup(keyword: string) {\n        return Array.from(this._popups).find((popup) => popup.keyword === keyword);\n    }\n\n    registerPopup(popup: IDocPopup) {\n        this._popups.add(popup);\n\n        return () => {\n            this._popups.delete(popup);\n        };\n    }\n\n    private _createInputPlaceholderRenderRoot(mount: () => IDisposable) {\n        const renderRoot: {\n            unmount?: IDisposable;\n            mount: () => void;\n        } = {\n            mount() {\n                this.unmount = mount();\n            },\n        };\n\n        return renderRoot;\n    }\n\n    showPopup(options: { popup: IDocPopup; index: number; unitId: string }) {\n        const { popup, index, unitId } = options;\n\n        this.closePopup();\n\n        const disposable = this._docCanvasPopupManagerService.attachPopupToRange(\n            { startOffset: index, endOffset: index, collapsed: true },\n            {\n                componentKey: QuickInsertPopup.componentKey,\n                onClickOutside: () => {\n                    this.closePopup();\n                },\n                direction: 'bottom',\n            },\n            unitId\n        );\n\n        this._inputPlaceholderRenderRoot = this._createInputPlaceholderRenderRoot(() => {\n            const disposable = this._docCanvasPopupManagerService.attachPopupToRange(\n                { startOffset: index + 1, endOffset: index + 1, collapsed: false },\n                {\n                    componentKey: KeywordInputPlaceholder.componentKey,\n                    onClickOutside: () => {\n                        disposable.dispose();\n                    },\n                    direction: 'horizontal',\n                },\n                unitId\n            );\n\n            return disposable;\n        });\n        this._inputPlaceholderRenderRoot.mount();\n\n        this._editPopup$.next({ disposable, popup, anchor: index, unitId });\n    }\n\n    closePopup() {\n        if (this.editPopup) {\n            this.editPopup.disposable.dispose();\n            this._editPopup$.next(null);\n        }\n    }\n\n    onMenuSelected(callback: (menu: IDocPopupMenuItem) => void) {\n        this._menuSelectedCallbacks.add(callback);\n\n        return () => {\n            this._menuSelectedCallbacks.delete(callback);\n        };\n    }\n\n    emitMenuSelected(menu: IDocPopupMenuItem) {\n        const { start, end } = this.inputOffset;\n        this._commandService.syncExecuteCommand(DeleteSearchKeyCommand.id, {\n            start,\n            end,\n        });\n        setTimeout(() => {\n            this._menuSelectedCallbacks.forEach((callback) => callback(menu));\n        }, 0);\n    }\n}\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { ICommand } from '@univerjs/core';\nimport type { IDocPopup } from '../../services/doc-quick-insert-popup.service';\nimport { CommandType } from '@univerjs/core';\nimport { DocQuickInsertPopupService } from '../../services/doc-quick-insert-popup.service';\n\nexport interface IShowQuickInsertPopupOperationParams {\n    unitId: string;\n    index: number;\n    popup: IDocPopup;\n}\n\nexport const ShowQuickInsertPopupOperation: ICommand<IShowQuickInsertPopupOperationParams> = {\n    type: CommandType.OPERATION,\n    id: 'doc.operation.show-quick-insert-popup',\n    handler(accessor, params) {\n        const docQuickInsertPopupService = accessor.get(DocQuickInsertPopupService);\n\n        if (!params) {\n            return false;\n        }\n\n        docQuickInsertPopupService.showPopup(params);\n\n        return true;\n    },\n};\n\nexport const CloseQuickInsertPopupOperation: ICommand = {\n    type: CommandType.OPERATION,\n    id: 'doc.operation.close-quick-insert-popup',\n    handler(accessor) {\n        const docQuickInsertPopupService = accessor.get(DocQuickInsertPopupService);\n\n        docQuickInsertPopupService.closePopup();\n\n        return true;\n    },\n};\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { DocPopupMenu, IDocPopupMenuItem } from '../services/doc-quick-insert-popup.service';\nimport { BulletListCommand, HorizontalLineCommand, OrderListCommand } from '@univerjs/docs-ui';\n\nexport enum QuickInsertMenuGroup {\n    Basic = 'quick.insert.group.basic',\n    Media = 'quick.insert.group.media',\n}\n\nexport const textMenu: IDocPopupMenuItem = {\n    id: 'quick-insert.text.menu',\n    title: 'docQuickInsert.menu.text',\n    icon: 'TextSingle',\n    keywords: ['text'],\n};\n\nexport const numberedListMenu: IDocPopupMenuItem = {\n    id: OrderListCommand.id,\n    title: 'docQuickInsert.menu.numberedList',\n    icon: 'OrderSingle',\n    keywords: ['numbered', 'list', 'ordered'],\n};\n\nexport const bulletedListMenu: IDocPopupMenuItem = {\n    id: BulletListCommand.id,\n    title: 'docQuickInsert.menu.bulletedList',\n    icon: 'UnorderSingle',\n    keywords: ['bulleted', 'list', 'unordered'],\n};\n\nexport const dividerMenu: IDocPopupMenuItem = {\n    id: HorizontalLineCommand.id,\n    title: 'docQuickInsert.menu.divider',\n    icon: 'DividerSingle',\n    keywords: ['divider', 'line', 'separate'],\n};\n\nexport const builtInMenus: DocPopupMenu[] = [\n    {\n        title: 'docQuickInsert.group.basics',\n        id: QuickInsertMenuGroup.Basic,\n        children: [\n            textMenu,\n            numberedListMenu,\n            bulletedListMenu,\n            dividerMenu,\n        ],\n    },\n];\n\nexport const builtInMenuCommandIds = new Set([\n    numberedListMenu.id,\n    bulletedListMenu.id,\n    dividerMenu.id,\n]);\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { IRichTextEditingMutationParams } from '@univerjs/docs';\nimport type { IDeleteCommandParams, IInsertCommandParams, IMoveCursorOperationParams } from '@univerjs/docs-ui';\nimport { DeleteDirection, Direction, Disposable, ICommandService, Inject } from '@univerjs/core';\nimport { DocSelectionManagerService, RichTextEditingMutation } from '@univerjs/docs';\nimport { DeleteCommand, DeleteLeftCommand, InsertCommand, MoveCursorOperation } from '@univerjs/docs-ui';\nimport { IShortcutService, KeyCode } from '@univerjs/ui';\nimport { CloseQuickInsertPopupOperation, ShowQuickInsertPopupOperation } from '../commands/operations/quick-insert-popup.operation';\nimport { DocQuickInsertPopupService } from '../services/doc-quick-insert-popup.service';\nimport { builtInMenuCommandIds, textMenu } from './built-in-menus';\n\nexport class DocQuickInsertTriggerController extends Disposable {\n    constructor(\n        @ICommandService private readonly _commandService: ICommandService,\n        @Inject(DocSelectionManagerService) private readonly _textSelectionManagerService: DocSelectionManagerService,\n        @Inject(DocQuickInsertPopupService) private readonly _docQuickInsertPopupService: DocQuickInsertPopupService,\n        @Inject(IShortcutService) private readonly _shortcutService: IShortcutService\n    ) {\n        super();\n\n        this.disposeWithMe(this._shortcutService.registerShortcut({\n            id: CloseQuickInsertPopupOperation.id,\n            binding: KeyCode.ESC,\n            preconditions: () => Boolean(this._docQuickInsertPopupService.editPopup),\n            priority: 1000,\n        }));\n\n        this._initTrigger();\n        this._initMenuHandler();\n    }\n\n    private _initTrigger() {\n        this.disposeWithMe(\n            // eslint-disable-next-line complexity\n            this._commandService.onCommandExecuted((commandInfo) => {\n                const { _docQuickInsertPopupService, _textSelectionManagerService, _commandService } = this;\n                if (commandInfo.id === InsertCommand.id) {\n                    const params = commandInfo.params as IInsertCommandParams;\n                    if (_docQuickInsertPopupService.editPopup) {\n                        _docQuickInsertPopupService.setInputOffset({\n                            start: _docQuickInsertPopupService.inputOffset.start,\n                            end: params.range.endOffset + 1,\n                        });\n                        return;\n                    }\n\n                    const activeRange = _textSelectionManagerService.getActiveTextRange();\n                    if (!activeRange) {\n                        return;\n                    }\n\n                    const popup = _docQuickInsertPopupService.resolvePopup(params.body.dataStream);\n                    if (!popup) {\n                        return;\n                    }\n\n                    const available = popup.preconditions ? popup.preconditions(params) : true;\n                    if (!available) {\n                        return;\n                    }\n\n                    _docQuickInsertPopupService.setInputOffset({ start: activeRange.startOffset - 1, end: activeRange.startOffset });\n\n                    setTimeout(() => {\n                        _commandService.executeCommand(ShowQuickInsertPopupOperation.id, {\n                            index: activeRange.startOffset - 1,\n                            unitId: params.unitId,\n                            popup,\n                        });\n                    }, 100);\n                }\n\n                if (commandInfo.id === RichTextEditingMutation.id) {\n                    const params = commandInfo.params as IRichTextEditingMutationParams;\n                    if (params.isCompositionEnd) {\n                        const endOffset = params.textRanges?.[0]?.endOffset;\n                        if (endOffset) {\n                            _docQuickInsertPopupService.setInputOffset({ start: _docQuickInsertPopupService.inputOffset.start, end: endOffset });\n                        }\n                    }\n                }\n\n                if (commandInfo.id === DeleteCommand.id) {\n                    const params = commandInfo.params as IDeleteCommandParams;\n                    if (_docQuickInsertPopupService.editPopup && params.direction === DeleteDirection.LEFT) {\n                        const len = params.len ?? 0;\n                        _docQuickInsertPopupService.setInputOffset({ start: _docQuickInsertPopupService.inputOffset.start, end: params.range.endOffset - len });\n                    }\n                }\n\n                if (commandInfo.id === MoveCursorOperation.id) {\n                    const params = commandInfo.params as IMoveCursorOperationParams;\n\n                    if (params.direction === Direction.LEFT || params.direction === Direction.RIGHT) {\n                        _docQuickInsertPopupService.editPopup && _commandService.executeCommand(CloseQuickInsertPopupOperation.id);\n                    }\n                }\n\n                if (commandInfo.id === DeleteLeftCommand.id) {\n                    const activeRange = _textSelectionManagerService.getActiveTextRange();\n                    if (!_docQuickInsertPopupService.editPopup || !activeRange) {\n                        return;\n                    }\n\n                    if (activeRange.endOffset <= _docQuickInsertPopupService.editPopup.anchor) {\n                        _commandService.executeCommand(CloseQuickInsertPopupOperation.id);\n                    }\n                }\n            })\n        );\n    }\n\n    private _initMenuHandler() {\n        this.disposeWithMe(this._docQuickInsertPopupService.onMenuSelected((menu) => {\n            if (menu.id === textMenu.id) {\n                return;\n            }\n\n            if (builtInMenuCommandIds.has(menu.id)) {\n                this._commandService.executeCommand(menu.id);\n            }\n        }));\n    }\n}\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { ITextRangeWithStyle } from '@univerjs/engine-render';\nimport type { IDocPopup } from '../services/doc-quick-insert-popup.service';\nimport { Disposable, ICommandService, Inject } from '@univerjs/core';\nimport { DividerSingle, TextSingle } from '@univerjs/icons';\nimport { ComponentManager } from '@univerjs/ui';\nimport { of } from 'rxjs';\nimport { DeleteSearchKeyCommand } from '../commands/commands/doc-quick-insert.command';\nimport { CloseQuickInsertPopupOperation, ShowQuickInsertPopupOperation } from '../commands/operations/quick-insert-popup.operation';\nimport { DocQuickInsertPopupService } from '../services/doc-quick-insert-popup.service';\nimport { KeywordInputPlaceholder } from '../views/KeywordInputPlaceholder';\nimport { QuickInsertPlaceholder } from '../views/QuickInsertPlaceholder';\nimport { QuickInsertPopup } from '../views/QuickInsertPopup';\nimport { builtInMenus } from './built-in-menus';\n\nexport class DocQuickInsertUIController extends Disposable {\n    constructor(\n        @ICommandService private readonly _commandService: ICommandService,\n        @Inject(DocQuickInsertPopupService) private readonly _docQuickInsertPopupService: DocQuickInsertPopupService,\n        @Inject(ComponentManager) private readonly _componentManager: ComponentManager\n    ) {\n        super();\n\n        this._initCommands();\n        this._initComponents();\n        this._initMenus();\n    }\n\n    private _initCommands() {\n        [\n            DeleteSearchKeyCommand,\n            ShowQuickInsertPopupOperation,\n            CloseQuickInsertPopupOperation,\n        ].forEach((operation) => {\n            this.disposeWithMe(this._commandService.registerCommand(operation));\n        });\n    }\n\n    private _initComponents() {\n        ([\n            [QuickInsertPopup.componentKey, QuickInsertPopup],\n            [KeywordInputPlaceholder.componentKey, KeywordInputPlaceholder],\n            [QuickInsertPlaceholder.componentKey, QuickInsertPlaceholder],\n            [DividerSingle.displayName, DividerSingle],\n            [TextSingle.displayName, TextSingle],\n        ] as const).forEach(([name, component]) => {\n            if (name) {\n                this.disposeWithMe(this._componentManager.register(name, component));\n            }\n        });\n\n        const popups: IDocPopup[] = [\n            {\n                keyword: '/',\n                menus$: of(builtInMenus),\n                // only show when the cursor is at the beginning of a line\n                preconditions: (params) => (params.range as ITextRangeWithStyle).startNodePosition?.glyph === 0,\n            },\n        ];\n\n        popups.forEach((popup) => {\n            this.disposeWithMe(this._docQuickInsertPopupService.registerPopup(popup));\n        });\n    }\n\n    private _initMenus() {\n\n    }\n}\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Dependency } from '@univerjs/core';\nimport { DependentOn, Inject, Injector, Plugin, UniverInstanceType } from '@univerjs/core';\nimport { UniverDocsDrawingPlugin } from '@univerjs/docs-drawing';\nimport { UniverDrawingPlugin } from '@univerjs/drawing';\nimport { UniverDrawingUIPlugin } from '@univerjs/drawing-ui';\nimport { UniverUIPlugin } from '@univerjs/ui';\nimport { DocQuickInsertTriggerController } from './controllers/doc-quick-insert-trigger.controller';\nimport { DocQuickInsertUIController } from './controllers/doc-quick-insert-ui.controller';\nimport { DocQuickInsertPopupService } from './services/doc-quick-insert-popup.service';\n\nconst PLUGIN_NAME = 'DOC_QUICK_INSERT_UI_PLUGIN';\n\n@DependentOn(UniverDrawingUIPlugin, UniverDrawingPlugin, UniverDocsDrawingPlugin, UniverUIPlugin)\nexport class UniverDocsQuickInsertUIPlugin extends Plugin {\n    static override type = UniverInstanceType.UNIVER_DOC;\n    static override pluginName = PLUGIN_NAME;\n\n    constructor(\n        @Inject(Injector) protected _injector: Injector\n    ) {\n        super();\n    }\n\n    override onStarting(): void {\n        const dependencies: Dependency[] = [\n            [DocQuickInsertUIController],\n            [DocQuickInsertTriggerController],\n            [DocQuickInsertPopupService],\n        ];\n\n        dependencies.forEach((dependency) => this._injector.add(dependency));\n\n        this._injector.get(DocQuickInsertUIController);\n    }\n\n    override onRendered(): void {\n        this._injector.get(DocQuickInsertTriggerController);\n        this._injector.get(DocQuickInsertPopupService);\n    }\n}\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const PLUGIN_NAME = 'DOC_THREAD_COMMENT_UI_PLUGIN';\n\nexport const DEFAULT_DOC_SUBUNIT_ID = 'default_doc';\n\nexport const DEFAULT_TEMP_COMMENT_ID = 'default_comment';\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { MenuConfig } from '@univerjs/ui';\n\nexport const DOCS_THREAD_COMMENT_UI_PLUGIN_CONFIG_KEY = 'docs-thread-comment-ui.config';\n\nexport const configSymbol = Symbol(DOCS_THREAD_COMMENT_UI_PLUGIN_CONFIG_KEY);\n\nexport interface IUniverDocsThreadCommentUIConfig {\n    menu?: MenuConfig;\n}\n\nexport const defaultPluginConfig: IUniverDocsThreadCommentUIConfig = {};\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { ITextRange, Nullable } from '@univerjs/core';\nimport type { IThreadComment } from '@univerjs/thread-comment';\nimport { Disposable, Inject } from '@univerjs/core';\nimport { ThreadCommentPanelService } from '@univerjs/thread-comment-ui';\nimport { ISidebarService } from '@univerjs/ui';\nimport { BehaviorSubject } from 'rxjs';\n\nexport class DocThreadCommentService extends Disposable {\n    private _addingComment$ = new BehaviorSubject<Nullable<IThreadComment & ITextRange>>(undefined);\n    readonly addingComment$ = this._addingComment$.asObservable();\n\n    get addingComment() {\n        return this._addingComment$.getValue();\n    }\n\n    constructor(\n        @ISidebarService private readonly _sidebarService: ISidebarService,\n        @Inject(ThreadCommentPanelService) private readonly _threadCommentPanelService: ThreadCommentPanelService\n    ) {\n        super();\n\n        this.disposeWithMe(() => {\n            this._addingComment$.complete();\n        });\n    }\n\n    startAdd(comment: IThreadComment & ITextRange) {\n        this._addingComment$.next(comment);\n    }\n\n    endAdd() {\n        this._addingComment$.next(undefined);\n    }\n}\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { DocumentDataModel } from '@univerjs/core';\nimport type { IAddDocCommentComment } from '../../commands/commands/add-doc-comment.command';\nimport type { IDeleteDocCommentComment } from '../../commands/commands/delete-doc-comment.command';\nimport { ICommandService, Injector, isInternalEditorID, IUniverInstanceService, UniverInstanceType } from '@univerjs/core';\nimport { DocSelectionManagerService, RichTextEditingMutation } from '@univerjs/docs';\nimport { ThreadCommentPanel } from '@univerjs/thread-comment-ui';\nimport { useDependency, useObservable } from '@univerjs/ui';\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { debounceTime, filter, Observable } from 'rxjs';\nimport { AddDocCommentComment } from '../../commands/commands/add-doc-comment.command';\nimport { DeleteDocCommentComment } from '../../commands/commands/delete-doc-comment.command';\nimport { StartAddCommentOperation } from '../../commands/operations/show-comment-panel.operation';\nimport { DEFAULT_DOC_SUBUNIT_ID } from '../../common/const';\nimport { shouldDisableAddComment } from '../../controllers/menu';\nimport { DocThreadCommentService } from '../../services/doc-thread-comment.service';\n\nexport const DocThreadCommentPanel = () => {\n    const univerInstanceService = useDependency(IUniverInstanceService);\n    const injector = useDependency(Injector);\n    const doc$ = useMemo(() => univerInstanceService.getCurrentTypeOfUnit$<DocumentDataModel>(UniverInstanceType.UNIVER_DOC).pipe(filter((doc) => !!doc && !isInternalEditorID(doc.getUnitId()))), [univerInstanceService]);\n    const doc = useObservable(doc$);\n    const subUnitId$ = useMemo(() => new Observable<string>((sub) => sub.next(DEFAULT_DOC_SUBUNIT_ID)), []);\n    const docSelectionManagerService = useDependency(DocSelectionManagerService);\n    const selectionChange$ = useMemo(\n        () => docSelectionManagerService.textSelection$.pipe(debounceTime(16)),\n        [docSelectionManagerService.textSelection$]\n    );\n    useObservable(selectionChange$);\n    const commandService = useDependency(ICommandService);\n    const docCommentService = useDependency(DocThreadCommentService);\n    const tempComment = useObservable(docCommentService.addingComment$);\n    const [commentIds, setCommentIds] = useState<string[]>([]);\n\n    useEffect(() => {\n        const set = new Set<string>();\n        const customRanges = doc?.getCustomDecorations();\n        setCommentIds(customRanges?.map((r) => r.id).filter((i) => {\n            const hasRepeat = set.has(i);\n            set.add(i);\n            return !hasRepeat;\n        }) ?? []);\n\n        const dispose = commandService.onCommandExecuted((command) => {\n            if (command.id === RichTextEditingMutation.id) {\n                const set = new Set<string>();\n                const customRanges = doc?.getCustomDecorations();\n                setCommentIds(customRanges?.map((r) => r.id).filter((i) => {\n                    const hasRepeat = set.has(i);\n                    set.add(i);\n                    return !hasRepeat;\n                }) ?? []);\n            }\n        });\n        return () => {\n            dispose.dispose();\n        };\n    }, [commandService, doc]);\n\n    if (!doc) {\n        return null;\n    }\n\n    const isInValidSelection = shouldDisableAddComment(injector);\n\n    const unitId = doc.getUnitId();\n\n    return (\n        <ThreadCommentPanel\n            unitId={unitId}\n            subUnitId$={subUnitId$}\n            type={UniverInstanceType.UNIVER_DOC}\n            onAdd={() => {\n                commandService.executeCommand(StartAddCommentOperation.id);\n            }}\n            getSubUnitName={() => ''}\n            disableAdd={isInValidSelection}\n            tempComment={tempComment}\n            onAddComment={(comment) => {\n                // attach an comment to an custom-range\n                if (!comment.parentId) {\n                    const params: IAddDocCommentComment = {\n                        unitId,\n                        range: tempComment!,\n                        comment,\n                    };\n                    commandService.executeCommand(AddDocCommentComment.id, params);\n                    docCommentService.endAdd();\n                    return false;\n                }\n\n                return true;\n            }}\n            onDeleteComment={(comment) => {\n                if (!comment.parentId) {\n                    const params: IDeleteDocCommentComment = {\n                        unitId,\n                        commentId: comment.id,\n                    };\n                    commandService.executeCommand(DeleteDocCommentComment.id, params);\n                    return false;\n                }\n                return true;\n            }}\n            showComments={commentIds}\n        />\n    );\n};\n\nDocThreadCommentPanel.componentKey = 'univer.doc.thread-comment-panel';\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { ICommand, ITextRange } from '@univerjs/core';\nimport type { IThreadComment } from '@univerjs/thread-comment';\nimport { CommandType, CustomDecorationType, ICommandService, sequenceExecute } from '@univerjs/core';\nimport { addCustomDecorationBySelectionFactory } from '@univerjs/docs-ui';\nimport { AddCommentMutation, IThreadCommentDataSourceService } from '@univerjs/thread-comment';\nimport { SetActiveCommentOperation } from '@univerjs/thread-comment-ui';\nimport { DEFAULT_DOC_SUBUNIT_ID } from '../../common/const';\n\nexport interface IAddDocCommentComment {\n    unitId: string;\n    comment: IThreadComment;\n    range: ITextRange;\n}\n\nexport const AddDocCommentComment: ICommand<IAddDocCommentComment> = {\n    id: 'docs.command.add-comment',\n    type: CommandType.COMMAND,\n    async handler(accessor, params) {\n        if (!params) {\n            return false;\n        }\n        const { comment: originComment, unitId } = params;\n        const dataSourceService = accessor.get(IThreadCommentDataSourceService);\n        const comment = await dataSourceService.addComment(originComment);\n        const commandService = accessor.get(ICommandService);\n\n        const doMutation = addCustomDecorationBySelectionFactory(\n            accessor,\n            {\n                id: comment.threadId,\n                type: CustomDecorationType.COMMENT,\n                unitId,\n            }\n        );\n        if (doMutation) {\n            const addComment = {\n                id: AddCommentMutation.id,\n                params: {\n                    unitId,\n                    subUnitId: DEFAULT_DOC_SUBUNIT_ID,\n                    comment,\n                },\n            };\n\n            const activeOperation = {\n                id: SetActiveCommentOperation.id,\n                params: {\n                    unitId,\n                    subUnitId: DEFAULT_DOC_SUBUNIT_ID,\n                    commentId: comment.id,\n                },\n            };\n\n            return (await sequenceExecute([addComment, doMutation, activeOperation], commandService)).result;\n        }\n\n        return false;\n    },\n};\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { ICommand } from '@univerjs/core';\nimport { CommandType, ICommandService, sequenceExecute } from '@univerjs/core';\nimport { deleteCustomDecorationFactory } from '@univerjs/docs-ui';\n\nexport interface IDeleteDocCommentComment {\n    unitId: string;\n    commentId: string;\n}\n\nexport const DeleteDocCommentComment: ICommand<IDeleteDocCommentComment> = {\n    id: 'docs.command.delete-comment',\n    type: CommandType.COMMAND,\n    async handler(accessor, params) {\n        if (!params) {\n            return false;\n        }\n        const { commentId, unitId } = params;\n        const commandService = accessor.get(ICommandService);\n\n        const doMutation = deleteCustomDecorationFactory(accessor, {\n            id: commentId,\n            unitId,\n        });\n\n        if (doMutation) {\n            return (await sequenceExecute([doMutation], commandService)).result;\n        }\n\n        return false;\n    },\n};\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { IAccessor } from '@univerjs/core';\nimport type { IMenuButtonItem } from '@univerjs/ui';\nimport { IUniverInstanceService, SHEET_EDITOR_UNITS, UniverInstanceType } from '@univerjs/core';\nimport { DocSelectionManagerService, DocSkeletonManagerService } from '@univerjs/docs';\nimport { DocumentEditArea, IRenderManagerService, withCurrentTypeOfRenderer } from '@univerjs/engine-render';\nimport { getMenuHiddenObservable, MenuItemType } from '@univerjs/ui';\nimport { debounceTime, Observable } from 'rxjs';\nimport { StartAddCommentOperation, ToggleCommentPanelOperation } from '../commands/operations/show-comment-panel.operation';\n\nexport const shouldDisableAddComment = (accessor: IAccessor) => {\n    const renderManagerService = accessor.get(IRenderManagerService);\n    const docSelectionManagerService = accessor.get(DocSelectionManagerService);\n    const skeleton = withCurrentTypeOfRenderer(\n        UniverInstanceType.UNIVER_DOC,\n        DocSkeletonManagerService,\n        accessor.get(IUniverInstanceService),\n        renderManagerService\n    )?.getSkeleton();\n\n    const editArea = skeleton?.getViewModel().getEditArea();\n    if (editArea === DocumentEditArea.FOOTER || editArea === DocumentEditArea.HEADER) {\n        return true;\n    }\n\n    const range = docSelectionManagerService.getActiveTextRange();\n\n    if (range == null || range.collapsed) {\n        return true;\n    }\n\n    return false;\n};\n\nexport function AddDocCommentMenuItemFactory(accessor: IAccessor): IMenuButtonItem {\n    return {\n        id: StartAddCommentOperation.id,\n        type: MenuItemType.BUTTON,\n        icon: 'CommentSingle',\n        title: 'threadCommentUI.panel.addComment',\n        tooltip: 'threadCommentUI.panel.addComment',\n        hidden$: getMenuHiddenObservable(accessor, UniverInstanceType.UNIVER_DOC, undefined, SHEET_EDITOR_UNITS),\n        disabled$: new Observable(function (subscribe) {\n            const textSelectionService = accessor.get(DocSelectionManagerService);\n            const observer = textSelectionService.textSelection$.pipe(debounceTime(16)).subscribe(() => {\n                subscribe.next(shouldDisableAddComment(accessor));\n            });\n\n            return () => {\n                observer.unsubscribe();\n            };\n        }),\n    };\n}\n\nexport function ToolbarDocCommentMenuItemFactory(accessor: IAccessor): IMenuButtonItem {\n    return {\n        id: ToggleCommentPanelOperation.id,\n        type: MenuItemType.BUTTON,\n        icon: 'CommentSingle',\n        title: 'threadCommentUI.panel.addComment',\n        tooltip: 'threadCommentUI.panel.addComment',\n        hidden$: getMenuHiddenObservable(accessor, UniverInstanceType.UNIVER_DOC),\n    };\n}\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { DocumentDataModel, ICommand } from '@univerjs/core';\nimport type { ActiveCommentInfo } from '@univerjs/thread-comment-ui';\nimport { BuildTextUtils, CommandType, ICommandService, IUniverInstanceService, UniverInstanceType, UserManagerService } from '@univerjs/core';\nimport { DocSelectionManagerService } from '@univerjs/docs';\nimport { DocSelectionRenderService } from '@univerjs/docs-ui';\nimport { IRenderManagerService } from '@univerjs/engine-render';\nimport { getDT } from '@univerjs/thread-comment';\nimport { ThreadCommentPanelService } from '@univerjs/thread-comment-ui';\nimport { ISidebarService } from '@univerjs/ui';\nimport { DEFAULT_DOC_SUBUNIT_ID } from '../../common/const';\nimport { DocThreadCommentService } from '../../services/doc-thread-comment.service';\nimport { DocThreadCommentPanel } from '../../views/doc-thread-comment-panel';\n\nexport interface IShowCommentPanelOperationParams {\n    activeComment: ActiveCommentInfo;\n}\n\nexport const ShowCommentPanelOperation: ICommand<IShowCommentPanelOperationParams> = {\n    id: 'docs.operation.show-comment-panel',\n    type: CommandType.OPERATION,\n    handler(accessor, params) {\n        const panelService = accessor.get(ThreadCommentPanelService);\n        const sidebarService = accessor.get(ISidebarService);\n\n        if (!panelService.panelVisible || sidebarService.options.children?.label !== DocThreadCommentPanel.componentKey) {\n            sidebarService.open({\n                header: { title: 'threadCommentUI.panel.title' },\n                children: { label: DocThreadCommentPanel.componentKey },\n                width: 320,\n                onClose: () => panelService.setPanelVisible(false),\n            });\n            panelService.setPanelVisible(true);\n        }\n\n        if (params) {\n            panelService.setActiveComment(params?.activeComment);\n        }\n\n        return true;\n    },\n};\n\nexport const ToggleCommentPanelOperation: ICommand = {\n    id: 'docs.operation.toggle-comment-panel',\n    type: CommandType.OPERATION,\n    handler(accessor) {\n        const panelService = accessor.get(ThreadCommentPanelService);\n        const sidebarService = accessor.get(ISidebarService);\n\n        if (!panelService.panelVisible || sidebarService.options.children?.label !== DocThreadCommentPanel.componentKey) {\n            sidebarService.open({\n                header: { title: 'threadCommentUI.panel.title' },\n                children: { label: DocThreadCommentPanel.componentKey },\n                width: 320,\n                onClose: () => panelService.setPanelVisible(false),\n            });\n            panelService.setPanelVisible(true);\n        } else {\n            sidebarService.close();\n            panelService.setPanelVisible(false);\n            panelService.setActiveComment(null);\n        }\n        return true;\n    },\n};\n\nexport const StartAddCommentOperation: ICommand = {\n    id: 'docs.operation.start-add-comment',\n    type: CommandType.OPERATION,\n    handler(accessor) {\n        const panelService = accessor.get(ThreadCommentPanelService);\n        const univerInstanceService = accessor.get(IUniverInstanceService);\n        const doc = univerInstanceService.getCurrentUnitForType<DocumentDataModel>(UniverInstanceType.UNIVER_DOC);\n        const docSelectionManagerService = accessor.get(DocSelectionManagerService);\n        const renderManagerService = accessor.get(IRenderManagerService);\n        const userManagerService = accessor.get(UserManagerService);\n        const docCommentService = accessor.get(DocThreadCommentService);\n        const commandService = accessor.get(ICommandService);\n        const sidebarService = accessor.get(ISidebarService);\n        const textRange = docSelectionManagerService.getActiveTextRange();\n        if (!doc || !textRange) {\n            return false;\n        }\n\n        const docSelectionRenderManager = renderManagerService.getRenderById(doc.getUnitId())?.with(DocSelectionRenderService);\n        docSelectionRenderManager?.setReserveRangesStatus(true);\n        if (textRange.collapsed) {\n            if (panelService.panelVisible) {\n                panelService.setPanelVisible(false);\n                sidebarService.close();\n            } else {\n                commandService.executeCommand(ShowCommentPanelOperation.id);\n            }\n            return true;\n        }\n\n        commandService.executeCommand(ShowCommentPanelOperation.id);\n        const unitId = doc.getUnitId();\n        const dataStream = (doc.getBody()?.dataStream ?? '').slice(textRange.startOffset, textRange.endOffset);\n        const text = BuildTextUtils.transform.getPlainText(dataStream);\n        const subUnitId = DEFAULT_DOC_SUBUNIT_ID;\n        const commentId = '';\n        const comment = {\n            unitId,\n            subUnitId,\n            id: commentId,\n            ref: text,\n            dT: getDT(),\n            personId: userManagerService.getCurrentUser().userID,\n            text: {\n                dataStream: '\\r\\n',\n            },\n            startOffset: textRange.startOffset!,\n            endOffset: textRange.endOffset!,\n            collapsed: true,\n            threadId: commentId,\n        };\n\n        docSelectionRenderManager?.blur();\n        docCommentService.startAdd(comment);\n        panelService.setActiveComment({\n            unitId,\n            subUnitId,\n            commentId,\n        });\n\n        return true;\n    },\n};\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { DocumentDataModel, ITextRange } from '@univerjs/core';\nimport type { ISetTextSelectionsOperationParams } from '@univerjs/docs';\nimport type { ITextRangeWithStyle } from '@univerjs/engine-render';\nimport { Disposable, ICommandService, Inject, isInternalEditorID, IUniverInstanceService, UniverInstanceType } from '@univerjs/core';\nimport { SetTextSelectionsOperation } from '@univerjs/docs';\nimport { DocBackScrollRenderController } from '@univerjs/docs-ui';\nimport { IRenderManagerService } from '@univerjs/engine-render';\nimport { ThreadCommentModel } from '@univerjs/thread-comment';\nimport { SetActiveCommentOperation, ThreadCommentPanelService } from '@univerjs/thread-comment-ui';\nimport { ShowCommentPanelOperation } from '../commands/operations/show-comment-panel.operation';\nimport { DEFAULT_DOC_SUBUNIT_ID } from '../common/const';\nimport { DocThreadCommentService } from '../services/doc-thread-comment.service';\n\nexport class DocThreadCommentSelectionController extends Disposable {\n    constructor(\n        @Inject(ThreadCommentPanelService) private readonly _threadCommentPanelService: ThreadCommentPanelService,\n        @IUniverInstanceService private readonly _univerInstanceService: IUniverInstanceService,\n        @ICommandService private readonly _commandService: ICommandService,\n        @Inject(DocThreadCommentService) private readonly _docThreadCommentService: DocThreadCommentService,\n        @IRenderManagerService private readonly _renderManagerService: IRenderManagerService,\n        @Inject(ThreadCommentModel) private readonly _threadCommentModel: ThreadCommentModel\n    ) {\n        super();\n\n        this._initSelectionChange();\n        this._initActiveCommandChange();\n    }\n\n    private _initSelectionChange() {\n        let lastSelection: ITextRange | undefined;\n        this.disposeWithMe(\n            this._commandService.onCommandExecuted((commandInfo) => {\n                if (commandInfo.id === SetTextSelectionsOperation.id) {\n                    const params = commandInfo.params as ISetTextSelectionsOperationParams;\n                    const { unitId, ranges } = params;\n                    if (isInternalEditorID(unitId)) return;\n                    const doc = this._univerInstanceService.getUnit<DocumentDataModel>(unitId, UniverInstanceType.UNIVER_DOC);\n                    const primary = ranges[0] as ITextRangeWithStyle | undefined;\n                    if (lastSelection?.startOffset === primary?.startOffset && lastSelection?.endOffset === primary?.endOffset) {\n                        return;\n                    }\n                    lastSelection = primary;\n                    if (primary && doc) {\n                        const { startOffset, endOffset, collapsed } = primary;\n                        let customRange;\n\n                        if (collapsed) { // cursor\n                            customRange = doc.getBody()?.customDecorations?.find((value) => value.startIndex <= startOffset && value.endIndex >= (endOffset - 1));\n                        } else { // range\n                            customRange = doc.getBody()?.customDecorations?.find((value) => value.startIndex <= startOffset && value.endIndex >= (endOffset - 1));\n                        }\n\n                        if (customRange) {\n                            const comment = this._threadCommentModel.getComment(unitId, DEFAULT_DOC_SUBUNIT_ID, customRange.id);\n                            if (comment && !comment.resolved) {\n                                this._commandService.executeCommand(ShowCommentPanelOperation.id, {\n                                    activeComment: {\n                                        unitId,\n                                        subUnitId: DEFAULT_DOC_SUBUNIT_ID,\n                                        commentId: customRange.id,\n                                    },\n                                });\n                            }\n                            return;\n                        }\n                    }\n\n                    if (!this._threadCommentPanelService.activeCommentId) {\n                        return;\n                    }\n\n                    this._commandService.executeCommand(SetActiveCommentOperation.id);\n                }\n            })\n        );\n    }\n\n    private _initActiveCommandChange() {\n        this.disposeWithMe(this._threadCommentPanelService.activeCommentId$.subscribe((activeComment) => {\n            if (activeComment) {\n                const doc = this._univerInstanceService.getUnit<DocumentDataModel>(activeComment.unitId);\n                if (doc) {\n                    const backScrollController = this._renderManagerService.getRenderById(activeComment.unitId)?.with(DocBackScrollRenderController);\n                    const customRange = doc.getBody()?.customDecorations?.find((range) => range.id === activeComment.commentId);\n                    if (customRange && backScrollController) {\n                        backScrollController.scrollToRange({\n                            startOffset: customRange.startIndex,\n                            endOffset: customRange.endIndex,\n                            collapsed: false,\n                        });\n                    }\n                }\n            }\n\n            if (!activeComment || activeComment.commentId !== this._docThreadCommentService.addingComment?.id) {\n                this._docThreadCommentService.endAdd();\n            }\n        }));\n    }\n}\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { MenuSchemaType } from '@univerjs/ui';\nimport { ContextMenuGroup, ContextMenuPosition, RibbonStartGroup } from '@univerjs/ui';\nimport {\n    StartAddCommentOperation,\n    ToggleCommentPanelOperation,\n} from '../commands/operations/show-comment-panel.operation';\nimport { AddDocCommentMenuItemFactory, ToolbarDocCommentMenuItemFactory } from './menu';\n\nexport const menuSchema: MenuSchemaType = {\n    [RibbonStartGroup.OTHERS]: {\n        [ToggleCommentPanelOperation.id]: {\n            order: 1,\n            menuItemFactory: ToolbarDocCommentMenuItemFactory,\n        },\n    },\n    [ContextMenuPosition.MAIN_AREA]: {\n        [ContextMenuGroup.DATA]: {\n            [StartAddCommentOperation.id]: {\n                order: 1,\n                menuItemFactory: AddDocCommentMenuItemFactory,\n            },\n        },\n    },\n};\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Disposable, ICommandService, Inject } from '@univerjs/core';\nimport { CommentSingle } from '@univerjs/icons';\nimport { ComponentManager, IMenuManagerService } from '@univerjs/ui';\nimport { AddDocCommentComment } from '../commands/commands/add-doc-comment.command';\nimport { DeleteDocCommentComment } from '../commands/commands/delete-doc-comment.command';\nimport { ShowCommentPanelOperation, StartAddCommentOperation, ToggleCommentPanelOperation } from '../commands/operations/show-comment-panel.operation';\nimport { DocThreadCommentPanel } from '../views/doc-thread-comment-panel';\nimport { menuSchema } from './menu.schema';\n\nexport class DocThreadCommentUIController extends Disposable {\n    constructor(\n        @ICommandService private readonly _commandService: ICommandService,\n        @IMenuManagerService private readonly _menuManagerService: IMenuManagerService,\n        @Inject(ComponentManager) private readonly _componentManager: ComponentManager\n    ) {\n        super();\n        this._initCommands();\n        this._initMenus();\n        this._initComponents();\n    }\n\n    private _initCommands() {\n        [\n            AddDocCommentComment,\n            DeleteDocCommentComment,\n            ShowCommentPanelOperation,\n            StartAddCommentOperation,\n            ToggleCommentPanelOperation,\n        ].forEach((command) => {\n            this.disposeWithMe(this._commandService.registerCommand(command));\n        });\n    }\n\n    private _initMenus() {\n        this._menuManagerService.mergeMenu(menuSchema);\n    }\n\n    private _initComponents() {\n        [DocThreadCommentPanel].forEach((comp) => {\n            this.disposeWithMe(this._componentManager.register(comp.componentKey, comp));\n        });\n\n        this.disposeWithMe(this._componentManager.register('CommentSingle', CommentSingle));\n    }\n}\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { DocumentDataModel } from '@univerjs/core';\nimport type { IRichTextEditingMutationParams } from '@univerjs/docs';\nimport type { IRenderContext, IRenderModule } from '@univerjs/engine-render';\nimport { CustomDecorationType, Disposable, ICommandService, Inject, IUniverInstanceService, UniverInstanceType } from '@univerjs/core';\nimport { DOC_INTERCEPTOR_POINT, DocInterceptorService, RichTextEditingMutation } from '@univerjs/docs';\nimport { DocRenderController } from '@univerjs/docs-ui';\nimport { ThreadCommentModel } from '@univerjs/thread-comment';\nimport { ThreadCommentPanelService } from '@univerjs/thread-comment-ui';\nimport { DEFAULT_DOC_SUBUNIT_ID } from '../../common/const';\n\nexport class DocThreadCommentRenderController extends Disposable implements IRenderModule {\n    constructor(\n        private readonly _context: IRenderContext<DocumentDataModel>,\n        @Inject(DocInterceptorService) private readonly _docInterceptorService: DocInterceptorService,\n        @Inject(ThreadCommentPanelService) private readonly _threadCommentPanelService: ThreadCommentPanelService,\n        @Inject(DocRenderController) private readonly _docRenderController: DocRenderController,\n        @IUniverInstanceService private readonly _univerInstanceService: IUniverInstanceService,\n        @Inject(ThreadCommentModel) private readonly _threadCommentModel: ThreadCommentModel,\n        @ICommandService private readonly _commandService: ICommandService\n    ) {\n        super();\n\n        this._interceptorViewModel();\n        this._initReRender();\n        this._initSyncComments();\n    }\n\n    private _initReRender() {\n        this.disposeWithMe(this._threadCommentPanelService.activeCommentId$.subscribe((activeComment) => {\n            if (activeComment) {\n                this._docRenderController.reRender(activeComment.unitId);\n                return;\n            }\n\n            const unitId = this._univerInstanceService.getCurrentUnitForType(UniverInstanceType.UNIVER_DOC)?.getUnitId();\n            if (unitId) {\n                this._docRenderController.reRender(unitId);\n            }\n        }));\n\n        this.disposeWithMe(this._threadCommentModel.commentUpdate$.subscribe((update) => {\n            if (update.type === 'resolve') {\n                this._docRenderController.reRender(update.unitId);\n            }\n        }));\n    }\n\n    private _interceptorViewModel() {\n        this._docInterceptorService.intercept(DOC_INTERCEPTOR_POINT.CUSTOM_DECORATION, {\n            handler: (data, pos, next) => {\n                if (!data) {\n                    return next(data);\n                }\n                const { unitId, index, customDecorations } = pos;\n                const activeComment = this._threadCommentPanelService.activeCommentId;\n                const { commentId, unitId: commentUnitID } = activeComment || {};\n                const activeCustomDecoration = customDecorations.find((i) => i.id === commentId);\n                const comment = this._threadCommentModel.getComment(unitId, DEFAULT_DOC_SUBUNIT_ID, data.id);\n                if (!comment) {\n                    return next({\n                        ...data,\n                        show: false,\n                    });\n                }\n\n                const isActiveIndex = activeCustomDecoration && index >= activeCustomDecoration.startIndex && index <= activeCustomDecoration.endIndex;\n                const isActive = commentUnitID === unitId && data.id === commentId;\n                return next({\n                    ...data,\n                    active: isActive || isActiveIndex,\n                    show: !comment.resolved,\n                });\n            },\n        });\n    }\n\n    private _initSyncComments() {\n        const unitId = this._context.unit.getUnitId();\n        const subUnitId = DEFAULT_DOC_SUBUNIT_ID;\n        const threadIds = this._context.unit.getBody()?.customDecorations?.filter((i) => i.type === CustomDecorationType.COMMENT).map((i) => i.id) ?? [];\n        threadIds.forEach((id) => {\n            const comment = this._threadCommentModel.getComment(unitId, subUnitId, id);\n            if (!comment) {\n                this._threadCommentModel.addComment(unitId, subUnitId, { id, threadId: id, ref: '', dT: '', personId: '', text: { dataStream: '' }, unitId, subUnitId });\n            }\n        });\n        threadIds.length && this._threadCommentModel.syncThreadComments(this._context.unit.getUnitId(), DEFAULT_DOC_SUBUNIT_ID, threadIds);\n\n        let prevThreadIds: string[] = threadIds.sort();\n        this.disposeWithMe(this._commandService.onCommandExecuted((commandInfo) => {\n            if (commandInfo.id === RichTextEditingMutation.id) {\n                const params = commandInfo.params as IRichTextEditingMutationParams;\n                if (params.unitId !== this._context.unit.getUnitId()) {\n                    return;\n                }\n\n                const currentThreadIds = this._context.unit.getBody()?.customDecorations?.filter((i) => i.type === CustomDecorationType.COMMENT).map((i) => i.id) ?? [];\n                const currentThreadIdsSorted = currentThreadIds.sort();\n                if (JSON.stringify(prevThreadIds) !== JSON.stringify(currentThreadIdsSorted)) {\n                    const preIds = new Set(prevThreadIds);\n                    const currentIds = new Set(currentThreadIdsSorted);\n                    const addIds = new Set<string>();\n                    const deleteIds = new Set<string>();\n\n                    currentThreadIds.forEach((id) => {\n                        if (!preIds.has(id)) {\n                            addIds.add(id);\n                        }\n                    });\n\n                    prevThreadIds.forEach((id) => {\n                        if (!currentIds.has(id)) {\n                            deleteIds.add(id);\n                        }\n                    });\n\n                    prevThreadIds = currentThreadIdsSorted;\n                    addIds.forEach((id) => {\n                        const comment = this._threadCommentModel.getComment(unitId, subUnitId, id);\n                        if (!comment) {\n                            this._threadCommentModel.addComment(unitId, subUnitId, { id, threadId: id, ref: '', dT: '', personId: '', text: { dataStream: '' }, unitId, subUnitId });\n                        }\n                    });\n\n                    // deleteIds.forEach((id) => {\n                    //     this._threadCommentModel.deleteThread(unitId, subUnitId, id);\n                    // });\n\n                    this._threadCommentModel.syncThreadComments(unitId, subUnitId, [...addIds]);\n                }\n            }\n        }));\n    }\n}\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Dependency } from '@univerjs/core';\nimport type { IUniverDocsThreadCommentUIConfig } from './controllers/config.schema';\nimport { DependentOn, IConfigService, Inject, Injector, merge, Plugin, UniverInstanceType } from '@univerjs/core';\nimport { IRenderManagerService } from '@univerjs/engine-render';\nimport { UniverThreadCommentUIPlugin } from '@univerjs/thread-comment-ui';\nimport { PLUGIN_NAME } from './common/const';\nimport { defaultPluginConfig, DOCS_THREAD_COMMENT_UI_PLUGIN_CONFIG_KEY } from './controllers/config.schema';\nimport { DocThreadCommentSelectionController } from './controllers/doc-thread-comment-selection.controller';\nimport { DocThreadCommentUIController } from './controllers/doc-thread-comment-ui.controller';\nimport { DocThreadCommentRenderController } from './controllers/render-controllers/render.controller';\nimport { DocThreadCommentService } from './services/doc-thread-comment.service';\n\n@DependentOn(UniverThreadCommentUIPlugin)\nexport class UniverDocsThreadCommentUIPlugin extends Plugin {\n    static override pluginName = PLUGIN_NAME;\n    static override type = UniverInstanceType.UNIVER_DOC;\n\n    constructor(\n        private readonly _config: Partial<IUniverDocsThreadCommentUIConfig> = defaultPluginConfig,\n        @Inject(Injector) protected _injector: Injector,\n        @IRenderManagerService private readonly _renderManagerSrv: IRenderManagerService,\n        @IConfigService private readonly _configService: IConfigService\n    ) {\n        super();\n\n        // Manage the plugin configuration.\n        const { menu, ...rest } = merge(\n            {},\n            defaultPluginConfig,\n            this._config\n        );\n        if (menu) {\n            this._configService.setConfig('menu', menu, { merge: true });\n        }\n        this._configService.setConfig(DOCS_THREAD_COMMENT_UI_PLUGIN_CONFIG_KEY, rest);\n    }\n\n    override onStarting(): void {\n        ([\n            [DocThreadCommentUIController],\n            [DocThreadCommentSelectionController],\n            [DocThreadCommentService],\n        ] as Dependency[]).forEach((dep) => {\n            this._injector.add(dep);\n        });\n    }\n\n    override onRendered(): void {\n        this._initRenderModule();\n\n        this._injector.get(DocThreadCommentSelectionController);\n        this._injector.get(DocThreadCommentUIController);\n    }\n\n    private _initRenderModule() {\n        [DocThreadCommentRenderController].forEach((dep) => {\n            this._renderManagerSrv.registerRenderModule(UniverInstanceType.UNIVER_DOC, dep as unknown as Dependency);\n        });\n    }\n}\n", "/**\n * Copyright 2023-present DreamNum Co., Ltd.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { LocaleType, LogLevel, Univer, UniverInstanceType, UserManagerService } from '@univerjs/core';\nimport { FUniver } from '@univerjs/core/facade';\nimport { UniverDebuggerPlugin } from '@univerjs/debugger';\nimport { defaultTheme } from '@univerjs/design';\nimport { UniverDocsPlugin } from '@univerjs/docs';\nimport { UniverDocsDrawingUIPlugin } from '@univerjs/docs-drawing-ui';\nimport { UniverDocsHyperLinkUIPlugin } from '@univerjs/docs-hyper-link-ui';\nimport { UniverDocsMentionUIPlugin } from '@univerjs/docs-mention-ui';\nimport { UniverDocsQuickInsertUIPlugin } from '@univerjs/docs-quick-insert-ui';\nimport { UniverDocsThreadCommentUIPlugin } from '@univerjs/docs-thread-comment-ui';\nimport { UniverDocsUIPlugin } from '@univerjs/docs-ui';\nimport { UniverFormulaEnginePlugin } from '@univerjs/engine-formula';\nimport { UniverRenderEnginePlugin } from '@univerjs/engine-render';\nimport { DEFAULT_DOCUMENT_DATA_CN } from '@univerjs/mockdata';\nimport { UniverUIPlugin } from '@univerjs/ui';\nimport { enUS, faIR, ruRU, zhCN } from '../locales';\n\nimport '../global.css';\n\n/* eslint-disable node/prefer-global/process */\nconst IS_E2E: boolean = !!process.env.IS_E2E;\n\n// univer\nconst univer = new Univer({\n    theme: defaultTheme,\n    locale: LocaleType.ZH_CN,\n    locales: {\n        [LocaleType.ZH_CN]: zhCN,\n        [LocaleType.EN_US]: enUS,\n        [LocaleType.RU_RU]: ruRU,\n        [LocaleType.FA_IR]: faIR,\n    },\n    logLevel: LogLevel.VERBOSE,\n});\n\n// core plugins\nuniver.registerPlugin(UniverRenderEnginePlugin);\nuniver.registerPlugin(UniverFormulaEnginePlugin);\nuniver.registerPlugin(UniverDebuggerPlugin);\nuniver.registerPlugin(UniverUIPlugin, {\n    container: 'app',\n});\n\nuniver.registerPlugin(UniverDocsPlugin);\nuniver.registerPlugin(UniverDocsUIPlugin, {\n    container: 'univerdoc',\n    layout: {\n        docContainerConfig: {\n            innerLeft: false,\n        },\n    },\n});\n\nuniver.registerPlugin(UniverDocsDrawingUIPlugin);\nuniver.registerPlugin(UniverDocsThreadCommentUIPlugin);\nuniver.registerPlugin(UniverDocsHyperLinkUIPlugin);\nuniver.registerPlugin(UniverDocsMentionUIPlugin);\nuniver.registerPlugin(UniverDocsQuickInsertUIPlugin);\n\nif (!IS_E2E) {\n    univer.createUnit(UniverInstanceType.UNIVER_DOC, DEFAULT_DOCUMENT_DATA_CN);\n}\n\n// use for console test\ndeclare global {\n    // eslint-disable-next-line ts/naming-convention\n    interface Window {\n        univer?: Univer;\n    }\n}\n\nwindow.univer = univer;\nconst injector = univer.__getInjector();\nconst userManagerService = injector.get(UserManagerService);\n\nconst mockUser = {\n    userID: 'Owner_qxVnhPbQ',\n    name: 'Owner',\n    avatar: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAInSURBVHgBtZU9TxtBEIbfWRzFSIdkikhBSqRQkJqkCKTCFkqVInSUSaT0wC8w/gXxD4gU2nRJkXQWhAZowDUUWKIwEgWWbEEB3mVmx3dn4DA2nB/ppNuPeWd29mMIPXDr+RxwtgRHeW6+guNPRxogqnL7Dwz9psJ27S4NShaeZTH3kwXy6I81dlRKcmRui88swdq9AcSFL7Buz1Vmlns64MiLsCjzwnIYHLH57tbfFbs7KRaXyEU8FVZofqccOfA5l7Q8LPIkGrwnb2RPNEXWFVMUF3L+kDCk0btDDAMzOm5YfAHDwp4tG74wnzAsiOYMnJ3GoDybA7IT98/jm5+JNnfiIzAS6LlqHQBN/i6b2t/cV1Hh6BfwYlHnHP4AXi5q/8kmMMpOs8+BixZw/Fd6xUEHEbnkgclvQP2fGp7uShRKnQ3G32rkjV1th8JhIGG7tR/JyjGteSOZELwGMmNqIIigRCLRh2OZIE6BjItdd7pCW6Uhm1zzkUtungSxwEUzNpQ+GQumtH1ej1MqgmNT6vwmhCq5yuwq56EYTbgeQUz3yvrpV1b4ok3nYJ+eYhgYmjRUqErx2EDq0Fr8FhG++iqVGqxlUJI/70Ar0UgJaWHj6hYVHJrfKssAHot1JfqwE9WVWzXZVd5z2Ws/4PnmtEjkXeKJDvxUecLbWOXH/DP6QQ4J72NS0adedp1aseBfXP8odlZFfPvBF7SN/8hky1TYuPOAXAEipMx15u5ToAAAAABJRU5ErkJggg==',\n    anonymous: false,\n    canBindAnonymous: false,\n};\nuserManagerService.setCurrentUser(mockUser);\nwindow.univerAPI = FUniver.newAPI(univer);\n"],
  "mappings": "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",
  "names": ["_a", "configSymbol", "defaultPluginConfig", "body", "matchedRange", "index_module_default", "import_jsx_runtime", "index_module_default", "defaultPluginConfig", "import_jsx_runtime", "import_react", "import_jsx_runtime", "import_jsx_runtime", "id", "menus", "getBodySlice", "disposable", "PLUGIN_NAME", "configSymbol", "defaultPluginConfig", "import_react", "import_jsx_runtime", "injector", "doc", "_a", "set", "customRanges", "userManagerService", "menuSchema", "menuSchema", "_a", "_b", "_c", "defaultPluginConfig", "PLUGIN_NAME"]
}
